<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="author" content="Alexey Loubyansky">
<title>PM Provisioning Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>PM Provisioning Documentation</h1>
<div class="details">
<span id="author" class="author">Alexey Loubyansky</span><br>
<span id="revnumber">version 1.0.0.Alpha-SNAPSHOT,</span>
<span id="revdate">2017-11-16</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">1. Overview</a></li>
<li><a href="#_feature_packs">2. Feature-packs</a>
<ul class="sectlevel2">
<li><a href="#_feature_pack_archive_structure">2.1. Feature-pack archive structure</a></li>
<li><a href="#_feature_pack_metadata_feature_pack_xml">2.2. Feature-pack metadata (feature-pack.xml)</a></li>
</ul>
</li>
<li><a href="#_provisioning_fs_content">3. Provisioning FS content</a>
<ul class="sectlevel2">
<li><a href="#_feature_pack_packages">3.1. Feature-pack packages</a></li>
<li><a href="#_provisioned_package_set">3.2. Provisioned package set</a></li>
</ul>
</li>
<li><a href="#_provisioned_installation_configuration">4. Provisioned installation configuration</a>
<ul class="sectlevel2">
<li><a href="#_generic_configuration_model">4.1. Generic configuration model</a></li>
<li><a href="#_configuration_model_attributes">4.2. Configuration model attributes</a></li>
<li><a href="#_excluding_default_configs_from_the_installation">4.3. Excluding default configs from the installation</a></li>
<li><a href="#_picking_default_configs_into_the_installation">4.4. Picking default configs into the installation</a></li>
<li><a href="#_configuration_model_merges">4.5. Configuration model merges</a></li>
<li><a href="#_content_of_the_config_element">4.6. Content of the config element</a></li>
<li><a href="#_config_package_dependencies">4.7. Config package dependencies</a></li>
</ul>
</li>
<li><a href="#_wildfly_provisioning">5. WildFly provisioning</a>
<ul class="sectlevel2">
<li><a href="#_wildfly_pm_provisioning_plug_in">5.1. WildFly PM Provisioning Plug-in</a></li>
<li><a href="#_wildfly_feature_pack_building_maven_plug_in">5.2. WildFly Feature-pack Building Maven Plug-in</a></li>
<li><a href="#_demo">5.3. Demo</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>&#169; 2017 The original authors.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">1. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>PM is a Maven repository-based provisioning tool designed to manage Java software environments that consist of one or more products. The tool supports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>installation of product releases;</p>
<div class="ulist">
<ul>
<li>
<p>their default and customized configurations;</p>
</li>
</ul>
</div>
</li>
<li>
<p>integration of the installed products;</p>
</li>
<li>
<p>resolution and verification of the binary and configuration dependencies;</p>
</li>
<li>
<p>patching and the version updates;</p>
</li>
<li>
<p>product-specific provisioning plugins;</p>
</li>
<li>
<p>identification of the changes to the provisioned software (the FS content and/or the configuration) applied manually or using thirdparty tools;</p>
</li>
<li>
<p>export the current environment configuration with the goal to reproduce it later at another location.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The tool comes with a command-line interface and a public API.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_feature_packs">2. Feature-packs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Feature-pack represents a released unit of software that can be installed or uninstalled using the provisioning tool. Feature-packs are Maven artifacts identified by GAV (groupId, artifactId and version).</p>
</div>
<div class="paragraph">
<p>Feature-pack contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>metadata describing</p>
<div class="ulist">
<ul>
<li>
<p>the feature-pack;</p>
</li>
<li>
<p>default distribution spec;</p>
</li>
<li>
<p>what and how can be customized;</p>
</li>
<li>
<p>dependencies on other featurepacks;</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>(optional)</em> a set of content packages;</p>
</li>
<li>
<p><em>(optional)</em> a set of configuration features;</p>
</li>
<li>
<p><em>(optional)</em> various resources required to properly assemble and setup the installation;</p>
</li>
<li>
<p><em>(optional)</em> custom provisioning plug-ins.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Feature-pack may declare dependencies on other feature-packs. Before a feature-pack is installed the tool will make sure its dependencies are satisifed (installing the missing ones).</p>
</div>
<div class="paragraph">
<p>Conceptually, any software installation can be described as one or more feature-packs installed at a specific location.</p>
</div>
<div class="sect2">
<h3 id="_feature_pack_archive_structure">2.1. Feature-pack archive structure</h3>
<div class="paragraph">
<p>Feature-packs are distributed as ZIP archives with the following root entries:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">feature-pack.zip
|- feature_groups/
|- features/
|- packages/
|- plugins/
|- resources/
`- feature-pack.xml</pre>
</div>
</div>
<div class="paragraph">
<p>Where</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>feature_groups</strong> - optional directory containing feature group descriptions;</p>
</li>
<li>
<p><strong>features</strong> - optional directory containing configuration feature specs;</p>
</li>
<li>
<p><strong>packages</strong> - optional directory containing content packages;</p>
</li>
<li>
<p><strong>resources</strong> - optional directory containing various resources needed to properly setup the installation;</p>
</li>
<li>
<p><strong>plugins</strong> - optional directory containing project/product-specific provisioning plug-ins;</p>
</li>
<li>
<p><strong>feature-pack.xml</strong> - metadata describing the feature-pack and the default distribution.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_feature_pack_metadata_feature_pack_xml">2.2. Feature-pack metadata (feature-pack.xml)</h3>
<div class="paragraph">
<p>Feature-pack metadata contains the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>GAV</strong> - feature-pack groupId, artifactId and version;</p>
</li>
<li>
<p><em>(optional)</em> <strong>dependencies</strong> -  dependencies on other feature-packs.</p>
</li>
<li>
<p><em>(optional)</em> <strong>config</strong> -  config elements describe the default configurations are generated generated for the installation (there could be more than one configuration);</p>
</li>
<li>
<p><em>(optional)</em> <strong>default packages</strong> - the names of the packages that are installed by default.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an illustration of how it may look like in a <strong>feature-pack.xml</strong> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.my-group"
                artifactId="my-artifact"
                version="1.0.0.Alpha1"&gt;
    &lt;dependencies&gt;
        &lt;dependency groupId="org.another-group"
                    artifactId="another-artifact"
                    version="3.0.0.Final"/&gt;
    &lt;/dependencies&gt;
    &lt;config&gt;
        &lt;props&gt;
            &lt;prop name="prop1" value="value1"/&gt;
            &lt;prop name="prop2" value="value2"/&gt;
        &lt;/props&gt;
        &lt;feature-group name="group1"/&gt;
        &lt;feature spec="feature1"&gt;
            &lt;param name="p1" value="v1" /&gt;
            &lt;param name="p2" value="v2" /&gt;
        &lt;/feature&gt;
    &lt;/config&gt;
    &lt;default-packages&gt;
        &lt;package name="package1"/&gt;
        &lt;package name="package2"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>feature-pack <strong>org.my-group:my-artifact:1.0.0.Alpha1</strong> depends on feature-pack <strong>org.another-group:another-artifact:3.0.0.Final</strong>;</p>
</li>
<li>
<p>config element describes the default configuration that will be generated;</p>
</li>
<li>
<p>packages <strong>package1</strong> and <strong>package2</strong> are installed by default.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_provisioning_fs_content">3. Provisioning FS content</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Provisioning file system content is organized into packages. What is provisioned content-wise at the end depends on which packages were selected for the target installation.</p>
</div>
<div class="sect2">
<h3 id="_feature_pack_packages">3.1. Feature-pack packages</h3>
<div class="paragraph">
<p>A package is a minimal atomic unit of a file system content that can be included into or excluded from the installation. It could be a set of files and/or provisioning-related resources attached to the package and used by the provisioning tool to provision a piece of an FS content.</p>
</div>
<div class="paragraph">
<p>Essentially, a software release (FS content-wise) is represented as a set of packages released under a common version.</p>
</div>
<div class="paragraph">
<p>Package contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>metadata describing the package;</p>
</li>
<li>
<p><em>(optional)</em> FS content which is copied to the installation when the package is installed;</p>
</li>
<li>
<p><em>(optional)</em> other provisioning resources that are used during provisioning to generate and/or integrate the content (or what the package represents) properly into the target installation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Package may declare dependencies on other packages that belong to the same or another feature-pack. Before a package is installed, the tool will make sure all its dependencies are satisifed (which includes automatic installation of the ones that are missing from the installation).</p>
</div>
<div class="paragraph">
<p>Package is identified by its name. The name must be unique in the feature-pack the package belongs to.</p>
</div>
<div class="paragraph">
<p>Packages are not versioned. Only the feature-pack has a version.</p>
</div>
<div class="sect3">
<h4 id="_package_directory_structure">3.1.1. Package directory structure</h4>
<div class="paragraph">
<p>Packages are stored in the directories (named after the packages) under the feature-pack <strong>packages</strong> directory.</p>
</div>
<div class="paragraph">
<p>Package directory contains the following entries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>package.xml</strong> - the metadata describing the package;</p>
</li>
<li>
<p><em>(optional)</em> <strong>content</strong> - directory containing the content of the package which will be copied to the installation when the package is installed;</p>
</li>
<li>
<p><em>(optional)</em> <strong>pm</strong> - directory containing various resources needed to properly provision the content of the package.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an illustration of the <strong>packages</strong> entry from a feature-pack archive containing packages p1, p2, p3 and p4:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">packages/
|-p1/
| |-content/
| | `-...
| |-pm/
| | `-...
| `-package.xml
|-p2/
| |-content/
| | `-...
| `-package.xml
|-p3/
| |-pm/
| | `-...
| `-package.xml
`-p4/
  `-package.xml</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_package_metadata_package_xml">3.1.2. Package metadata (package.xml)</h4>
<div class="paragraph">
<p>Package metadata contains the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>package name</strong>;</p>
</li>
<li>
<p><em>(optional)</em> <strong>dependencies</strong> - dependencies on other packages from the same or other feature-packs;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an illustration of how a <strong>package.xml</strong> might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;package-spec xmlns="urn:wildfly:pm-package:1.0" name="p1"&gt;
    &lt;dependencies&gt;
        &lt;package name="p2"/&gt;
        &lt;package name="p3" optional="true"/&gt;
        &lt;feature-pack dependency="another-feature-pack"&gt;
            &lt;package name="p1"/&gt;
            &lt;package name="p11" optional="true"/&gt;
        &lt;/feature-pack&gt;
    &lt;/dependencies&gt;
 &lt;/package-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here package <strong>p1</strong> declares dependencies on packages <strong>p2</strong> and <strong>p3</strong> that belong to the same feature-pack as <strong>p1</strong> and packages <strong>p1</strong> and <strong>p11</strong> that belong to another feature-pack referenced by the alias <strong>another-feature-pack</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_package_dependencies">3.1.3. Package dependencies</h4>
<div class="paragraph">
<p><a id="package-deps"></a>Package dependency may be required or optional.</p>
</div>
<div class="paragraph">
<p><strong>Required dependency</strong> means that a package cannot be installed unless all its required dependencies are satisfied, i.e. installed. If any required dependency cannot be satisfied (perhaps because a package that happens to be a required dependency has been explicitly excluded from the installation), the provisioning process will fail with an error.</p>
</div>
<div class="paragraph">
<p><strong>Optional dependency</strong> means that the dependency does not have to be satisfied for the package to be installed. For example if package <strong>p1</strong> declares an optional dependency on package <strong>p2</strong> and <strong>p2</strong> is explicitly excluded by the user, <strong>p1</strong> will still be installed. An example of an optional dependency could be a package called <strong>documentation</strong> which declares an optional dependency on package <strong>examples</strong>. If a user is not interested in the <strong>examples</strong>, the rest of the <strong>documentation</strong> could still be installed.</p>
</div>
<div class="paragraph">
<p>Package dependencies are also used to determine the <a href="#_feature_pack_without_dependencies">effective package set of a feature-pack</a> to be installed described later.</p>
</div>
</div>
<div class="sect3">
<h4 id="_local_package_dependencies">3.1.4. Local package dependencies</h4>
<div class="paragraph">
<p>If a package depends on another package from the same feature-pack, the dependency is called a local package dependency. Here is an example of how local dependencies are expressed in the XML metadata:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;package-spec xmlns="urn:wildfly:pm-package:1.0" name="p1"&gt;
    &lt;dependencies&gt;
        &lt;package name="p2"/&gt;
        &lt;package name="p3" optional=”true”/&gt;
    &lt;/dependencies&gt;
 &lt;/package-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example <strong>p2</strong> is a required dependency of <strong>p1</strong> while <strong>p3</strong> is an optional one.</p>
</div>
</div>
<div class="sect3">
<h4 id="_external_package_dependencies">3.1.5. External package dependencies</h4>
<div class="paragraph">
<p>If a package depends on a package from another feature-pack, the dependency is called an external package dependency.</p>
</div>
<div class="paragraph">
<p>Although a package may declare a dependency on a package from another feature-pack, it cannot specify the version of the feature-pack in the package dependency declaration.</p>
</div>
<div class="paragraph">
<p>Feature-pack containing a package with an external dependency must declare an explicit dependency on the feature-pack (specifying its version) the target package of the external dependency belongs to. This feature-pack dependency must also be assigned a name which will be used as a reference to the that dependency in the <strong>package.xml</strong> file where the external package dependency is declared.</p>
</div>
<div class="paragraph">
<p>For example, suppose feature-pack <strong>fp1</strong> depends on feature-pack <strong>fp2</strong> and package <strong>fp1:p1</strong> depends on packages <strong>fp2:p1</strong> and <strong>fp2:p10</strong>. The <strong>feature-pack.xml</strong> of <strong>fp1</strong> might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0"&gt;
    &lt;dependencies&gt;
        &lt;dependency groupId="org.jboss.pm.test" artifactId="fp2" version="2.0.0"&gt;
            &lt;name&gt;fp2-dep&lt;/name&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the <strong>package.xml</strong> file of <strong>fp1:p1</strong> might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;package-spec xmlns="urn:wildfly:pm-package:1.0" name="p1"&gt;
    &lt;dependencies&gt;
        &lt;package name="p2" /&gt;
        &lt;feature-pack dependency=”fp2-dep”&gt;
            &lt;package name=”p1” /&gt;
            &lt;package name=”p10” /&gt;
        &lt;/feature-pack&gt;
        &lt;package name="p3" /&gt;
    &lt;/dependencies&gt;
 &lt;/package-spec&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_provisioned_package_set">3.2. Provisioned package set</h3>
<div class="paragraph">
<p>This chapter is dedicated to the effective (resolved) package set of the installation&#8217;s provisioning specification.</p>
</div>
<div class="sect3">
<h4 id="_feature_pack_without_dependencies">3.2.1. Feature-pack without dependencies</h4>
<div class="paragraph">
<p>This chapter focuses on a single feature-pack without dependencies. Effective package set of feature packs with dependencies will be covered in a separate chapter.</p>
</div>
<div class="sect4">
<h5 id="_feature_pack_default_packages">Feature-pack default packages</h5>
<div class="paragraph">
<p>Feature pack may define a set of default packages. This set of default packages is installed implicitly when the feature-pack is installed unless the user provides explicit instructions which packages to install.</p>
</div>
<div class="paragraph">
<p>Default packages are explicitly listed in the <strong>feature-pack.xml</strong> file which is a part of the feature-pack archive. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.fp.group1" artifactId="fp1" version="1.0.0" &gt;
    &lt;default-packages&gt;
        &lt;package name="package1" /&gt;
        &lt;package name="package2" /&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case this feature-pack is installed without further customizations, <strong>package1</strong> and <strong>package2</strong> will be installed by default, although the feature-pack above may still contain other packages (not listed as default) that may not get installed.</p>
</div>
</div>
<div class="sect4">
<h5 id="_feature_pack_non_default_packages">Feature-pack non-default packages</h5>
<div class="paragraph">
<p>Feature-pack may contain packages that are not marked as default in the <strong>feature-pack.xml</strong>. Non-default packages can be installed either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>implicitly, in case a default package expressed a dependency on a non-default package;</p>
</li>
<li>
<p>explicitly, in case a user explicitly selected a non-default package to be installed.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_feature_pack_original_effective_package_set">Feature-pack original effective package set</h5>
<div class="paragraph">
<p><em>Original</em> in the title means not explicitly modified. I.e. a set of packages which is going to be installed when a feature-pack is installed as-is without any user customization.</p>
</div>
<div class="paragraph">
<p>The feature-pack&#8217;s original effective package set consists of all the default packages of the feature-pack plus all the packages from the package dependency trees originating from the default packages.</p>
</div>
</div>
<div class="sect4">
<h5 id="_explicit_package_exclusion">Explicit package exclusion</h5>
<div class="paragraph">
<p>A package may be explicitly excluded from the feature-pack&#8217;s effective package set. For example, given the following feature-pack definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.fp.group1" artifactId="fp1" version="1.0.0" &gt;
    &lt;default-packages&gt;
        &lt;package name="p1" /&gt;
        &lt;package name="p2" /&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and assuming that</p>
</div>
<div class="ulist">
<ul>
<li>
<p>package <strong>p1</strong> has an optional dependency on non-default package <strong>p11</strong></p>
</li>
<li>
<p>package <strong>p2</strong> has an optional dependency on non-default package <strong>p22</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The original effective package set of <strong>fp1</strong> includes <strong>p1</strong>, <strong>p11</strong>, <strong>p2</strong> and <strong>p22</strong>.</p>
</div>
<div class="paragraph">
<p>If a user is interested in a subset of the effective package set, in fact, only in package <strong>p1</strong>, for example, it can be expressed in the provisioning XML configuration file as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack groupId="org.jboss.group1" artifactId="fp1" version="1.0.0"&gt;
    &lt;packages&gt;
        &lt;exclude name="p11"/&gt;
        &lt;exclude name="p2"/&gt;
    &lt;/packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Packages <strong>p11</strong> and <strong>p2</strong> are explicitly excluded and package <strong>p22</strong> is a non-default package which is not on the dependency tree originating from the packages to be installed, i.e. <strong>p1</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_explicit_package_inclusion">Explicit package inclusion</h5>
<div class="paragraph">
<p>A package may be explicitly included into the feature-pack&#8217;s effective package set. For example, given the following feature-pack definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.fp.group1" artifactId="fp1" version="1.0.0" &gt;
    &lt;default-packages&gt;
        &lt;package name="p1" /&gt;
        &lt;package name="p2" /&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and assuming that</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>p2</strong> has an optional dependency on non-default package <strong>p21</strong></p>
</li>
<li>
<p><strong>fp1</strong> also contains non-default package <strong>p3</strong></p>
</li>
<li>
<p><strong>p3</strong> has an optional dependency on non-default package <strong>p31</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The effective package set of <strong>fp1</strong> includes <strong>p1</strong>, <strong>p2</strong> and <strong>p21</strong>.</p>
</div>
<div class="paragraph">
<p>A user may explicitly add package <strong>p3</strong>, exclude <strong>p2</strong> and still leave <strong>p21</strong> in the effective package set using the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack groupId="org.jboss.group1" artifactId="fp1" version="1.0.0"&gt;
    &lt;packages&gt;
        &lt;include name="p3"/&gt;
        &lt;exclude name="p2"/&gt;
        &lt;include name="p21"/&gt;
    &lt;/packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The effective package set now will consist of <strong>p1</strong> (default package), <strong>p21</strong> (explicitly included non-default), <strong>p3</strong> (explicitly included non-default) and <strong>p31</strong> (brought in as a dependency of <strong>p3</strong>).</p>
</div>
<div class="paragraph">
<p>If, for example, the user wanted to further cut down the effective set to <strong>p21</strong> and <strong>p3</strong>, the configuration would change to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack groupId="org.jboss.group1" artifactId="fp1" version="1.0.0"&gt;
    &lt;packages&gt;
        &lt;exclude name="p1"/&gt;
        &lt;exclude name="p2"/&gt;
        &lt;include name="p21"/&gt;
        &lt;include name="p3"/&gt;
        &lt;exclude name="p31"/&gt;
    &lt;/packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_feature_pack_with_dependencies">3.2.2. Feature-pack with dependencies</h4>
<div class="paragraph">
<p>Feature pack may depend on one or more other feature-packs. Feature-pack dependencies are expressed in the feature-pack metadata, i.e. the <strong>feature-pack.xml</strong> file. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.fp.group1" artifactId="fp1" version="1.0.0" &gt;
    &lt;dependencies&gt;
        &lt;dependency groupId="org.jboss.dep.group1" artifactId="fp2" version="0.0.1"/&gt;
        &lt;dependency groupId="org.jboss.dep.group2" artifactId="fp3" version="0.0.2"/&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="package1"/&gt;
        &lt;package name="package2"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case feature-pack <strong>fp1</strong> depends on feature-packs <strong>fp2</strong> and <strong>fp3</strong>. Let&#8217;s also assume that <strong>fp3</strong> depends on feature-pack <strong>fp4</strong> and <strong>fp2</strong> and <strong>fp4</strong> don’t have any further dependencies. The effective package set of feature-pack <strong>fp1</strong> will consist of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the original effective package set of <strong>fp1</strong>;</p>
</li>
<li>
<p>the original effective package set of <strong>fp2</strong>;</p>
</li>
<li>
<p>the original effective package set of <strong>fp3</strong>;</p>
</li>
<li>
<p>the original effective package set of <strong>fp4</strong>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_customizing_the_inherited_package_set_from_a_dependency">Customizing the inherited package set from a dependency</h5>
<div class="paragraph">
<p>As shown in the example above, the effective package set of the dependency contributes to the effective package set of the feature-pack declaring the dependency. The feature-pack declaring the dependency, though, is allowed to customize the package set inherited from the dependency using the already seen before <strong>include</strong> and <strong>exclude</strong> XML elements in its <strong>feature-pack.xml</strong>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.fp.group1" artifactId="fp1" version="1.0.0" &gt;
    &lt;dependencies&gt;
        &lt;dependency groupId="org.jboss.fp.group2" artifactId="fp2" version="2.0.0"&gt;
            &lt;packages&gt;
                &lt;exclude name="p1"/&gt;
                &lt;exclude name="p2"/&gt;
                &lt;include name="p3"/&gt;
                &lt;include name="p4"/&gt;
            &lt;/packages&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
        &lt;package name="p2"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Package inclusion and exclusion under the dependency element in <strong>feature-pack.xml</strong> file follows the same principle (and the syntax) as it was described for the provisioning XML configuration file.</p>
</div>
<div class="paragraph">
<p>Now the original effective package set of <strong>fp1</strong> becomes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>fp1</strong> packages <strong>p1</strong> and <strong>p2</strong>;</p>
<div class="ulist">
<ul>
<li>
<p>plus their dependencies on non-default packages (if any);</p>
</li>
</ul>
</div>
</li>
<li>
<p>the original effective package set of <strong>fp2</strong>;</p>
<div class="ulist">
<ul>
<li>
<p>minus packages <strong>p1</strong> and <strong>p2</strong> from <strong>fp2</strong> and their dependencies on other packages;</p>
</li>
<li>
<p>plus packages <strong>p3</strong> and <strong>p4</strong> from <strong>fp2</strong> and their dependencies on other packages.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>Note</strong>: in case <strong>fp2</strong> in its turn depended on other feature-packs then <strong>fp1</strong> would inherit effective package sets of those feature-packs (possibly customized using include/exclude in the corresponding dependency declaration in the <strong>feature-pack.xml</strong> of <strong>fp2</strong>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_disabling_inheritance_of_a_dependency_package_set">Disabling inheritance of a dependency package set</h5>
<div class="paragraph">
<p>By default, the effective package set of a dependency is inherited by the feature-pack declaring the dependency. However, it is possible to declare the dependency without inheriting its effective package set and simply pick the packages explicity under the dependency element (in other words to explicitly define the effective package set of the dependency).</p>
</div>
<div class="paragraph">
<p>Optional boolean attribute <strong>inherit</strong> on the <strong>packages</strong> element controls whether the inheritance is enabled or disabled. In case the attribute is not explicitly specified, its value assumed to be true. Here is an example of a dependency with the inheritance disabled:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.fp.group1" artifactId="fp1" version="1.0.0" &gt;
    &lt;dependencies&gt;
        &lt;dependency groupId="org.jboss.fp.group2" artifactId="fp2" version="2.0.0"&gt;
            &lt;packages inherit=”false”&gt;
                &lt;exclude name="p1"/&gt;
                &lt;exclude name="p2"/&gt;
                &lt;include name="p3"/&gt;
                &lt;include name="p4"/&gt;
            &lt;/packages&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
        &lt;package name="p2"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the original effective package set of <strong>fp1</strong> becomes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>fp1</strong> packages <strong>p1</strong> and <strong>p2</strong>;</p>
<div class="ulist">
<ul>
<li>
<p>plus their dependencies on non-default packages (if any);</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>fp2</strong> packages <strong>p3</strong> and <strong>p4</strong>;</p>
<div class="ulist">
<ul>
<li>
<p>plus their dependencies on non-default packages minus packages <strong>p1</strong> and <strong>p2</strong> from <strong>fp2</strong> and their dependencies on other packages.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_explicit_vs_transitive_dependency_on_a_feature_pack">Explicit vs transitive dependency on a feature-pack</h5>
<div class="paragraph">
<p>Consider a case when feature-pack <strong>fp1</strong> depends on feature-packs <strong>fp2</strong> and <strong>fp3</strong>. And <strong>fp2</strong> in its turn also depends on <strong>fp3</strong>. In this case <strong>fp3</strong> is both transitive and explicit dependency of <strong>fp1</strong>.</p>
</div>
<div class="paragraph">
<p>The rule is that the package set of an explicit dependency overrides the package sets of a transitive dependency. In our case it means that installing <strong>fp1</strong>, the <strong>fp3</strong> package set <strong>fp1</strong> explicitly depends on will become the effective package set of <strong>fp3</strong> ignoring the package set of <strong>fp3</strong> inherited by <strong>fp2</strong> (whether it is a dependency on the original <strong>fp3</strong> or a custom set of its packages).</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.fp.group1" artifactId="fp1" version="1.0.0" &gt;
    &lt;dependencies&gt;
        &lt;dependency groupId="org.jboss.fp.group2" artifactId="fp2" version="2.0.0"/&gt;
        &lt;dependency groupId="org.jboss.fp.group2" artifactId="fp3" version="2.0.0"/&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.fp.group1" artifactId="fp2" version="1.0.0" &gt;
    &lt;dependencies&gt;
        &lt;dependency groupId="org.jboss.fp.group2" artifactId="fp3" version="2.0.0"&gt;
            &lt;packages&gt;
                &lt;exclude name="p1"/&gt;
                &lt;exclude name="p3"/&gt;
            &lt;/packages&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.fp.group1" artifactId="fp3" version="1.0.0" &gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
        &lt;package name="p2"/&gt;
        &lt;package name="p3"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Installing <strong>fp1</strong> without further customizations the following packages will be installed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>fp1:p1</strong> and its dependencies;</p>
</li>
<li>
<p><strong>fp2:p1</strong> and its dependencies;</p>
</li>
<li>
<p><strong>p1</strong>, <strong>p2</strong> and <strong>p3</strong> from <strong>fp3</strong> and their dependencies.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_merging_package_sets_from_dependency_branches">Merging package sets from dependency branches</h5>
<div class="paragraph">
<p>Suppose feature-pack <strong>fp1</strong> depends on feature-packs <strong>fp2</strong> and <strong>fp3</strong>. Both <strong>fp2</strong> and <strong>fp3</strong> depend on their own custom package sets of feature-pack <strong>fp4</strong>. When <strong>fp1</strong> is installed, the effective package set of <strong>fp4</strong> will be a merge of custom package sets of <strong>fp4</strong> specified as dependencies of <strong>fp2</strong> and <strong>fp3</strong>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.fp.group1" artifactId="fp1" version="1.0.0" &gt;
    &lt;dependencies&gt;
        &lt;dependency groupId="org.jboss.fp.group2" artifactId="fp2" version="2.0.0"/&gt;
        &lt;dependency groupId="org.jboss.fp.group2" artifactId="fp3" version="2.0.0"/&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.fp.group1" artifactId="fp2" version="1.0.0" &gt;
    &lt;dependencies&gt;
        &lt;dependency groupId="org.jboss.fp.group2" artifactId="fp4" version="2.0.0"&gt;
            &lt;packages&gt;
                &lt;exclude name="p1"/&gt;
                &lt;exclude name="p3"/&gt;
            &lt;/packages&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.fp.group1" artifactId="fp3" version="1.0.0" &gt;
    &lt;dependencies&gt;
        &lt;dependency groupId="org.jboss.fp.group2" artifactId="fp4" version="2.0.0"&gt;
            &lt;packages inherit=”false”&gt;
                &lt;!-- assume fp4 also contains non-default package p4 --&gt;
                &lt;include name="p4"/&gt;
            &lt;/packages&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.fp.group1" artifactId="fp4" version="1.0.0" &gt;
    &lt;default-packages&gt;
        &lt;package name="p1"/&gt;
        &lt;package name="p2"/&gt;
        &lt;package name="p3"/&gt;
    &lt;/default-packages&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a user installs <strong>fp1</strong> without further customizations, the following packages will be installed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>fp1:p1</strong> and its dependencies;</p>
</li>
<li>
<p><strong>fp2:p1</strong> and its dependencies;</p>
</li>
<li>
<p><strong>fp3:p1</strong> and its dependencies;</p>
</li>
<li>
<p><strong>fp4:p2</strong>, <strong>fp4:p4</strong> and their dependencies.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_provisioned_installation_configuration">4. Provisioned installation configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to provisioning the FS content the tool also supports generation of the configuration for the target installation taking into account the customizations of the feature-pack default settings applied by the user.</p>
</div>
<div class="paragraph">
<p>Feature-pack metadata (<strong>feature-pack.xml</strong>) may include one or more <strong>config</strong> elements each of which describes specific default installation configuration. In a simple (and perhaps the most common) case, the configuration described under the <strong>config</strong> element will represent a specific configuration file in the provisioned installation.</p>
</div>
<div class="paragraph">
<p>Installation configuration is described using a generic configuration model. The model allows a user to manipulate the confguration in a generic way by adding to and/or removing pieces from it, overwriting existing values. The responsibility of the tool with regards to the configuration is to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>resolve the final installation configuration taking into account the customizations applied to the defaults;</p>
</li>
<li>
<p>make sure the resolved configuration is valid by:</p>
<div class="ulist">
<ul>
<li>
<p>making sure that the required values are set;</p>
</li>
<li>
<p>verifying the referential integrity of the resolved configuration model (i.e. in case certain configuration pieces imply the presence of certain other configuration pieces);</p>
</li>
</ul>
</div>
</li>
<li>
<p>present the elements of the resolved configuration to the provisioning plugins in the order the configuration model was populated but also respecting the dependencies of the configuration elements.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The generic provisioning tool itself does not generate the final configuration files. As indicated above, it only resolves the effective generic configuration model for the provisioned installation. It is the responsibility of the product-specific provisioning plugins to generate the final configuration file(s) from the generic configuration model resolved by the core provisioning tool.</p>
</div>
<div class="sect2">
<h3 id="_generic_configuration_model">4.1. Generic configuration model</h3>
<div class="paragraph">
<p>Generic configuration model is based on an abstract schema that describes configurable units and relationships between them.</p>
</div>
<div class="sect3">
<h4 id="_features">4.1.1. Features</h4>
<div class="paragraph">
<p>Minimal configurable unit of the generic configuration model is called a <strong>feature</strong>. A <strong>feature</strong> is described by a <strong>feature specification</strong> (or <strong>feature spec</strong> further in the text). A <strong>feature spec</strong> is like a type and a <strong>feature</strong> is an instance of that type.</p>
</div>
<div class="paragraph">
<p>Feature specs are identified by their names that must be unique in the scope of the feature-pack.</p>
</div>
<div class="paragraph">
<p>A feature spec describes</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the configurable parameters (including their names, default values (if any) and whether they are nillable);</p>
</li>
<li>
<p><em>(optionally)</em> <a href="#feature-refs">references to other feature specs</a>;</p>
</li>
<li>
<p><em>(optionally)</em> <a href="#feature-deps">dependencies on other features</a>;</p>
</li>
<li>
<p><em>(optionally)</em> <a href="#caps">required capabilities</a>;</p>
</li>
<li>
<p><em>(optionally)</em> <a href="#caps">provided capabilities</a>;</p>
</li>
<li>
<p><em>(optionally)</em> <a href="#feature-package-deps">dependencies on packages</a>;</p>
</li>
<li>
<p><em>(optionally)</em> <a href="#feature-annotations">annnotations</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Feature specs are stored in the <strong>spec.xml</strong> files in the directories named after the feature spec names under the feature-pack&#8217;s <strong>features</strong> directory. For example</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">features/
|-feature1/
| `-spec.xml
`-feature2/
  `-spec.xml</pre>
</div>
</div>
<div class="sect4">
<h5 id="_feature_id">Feature ID</h5>
<div class="paragraph">
<p>A feature may have an identifier (<strong>feature id</strong> further in the text) which is used to locate a specific feature in the configuration model. Whether a feature has an ID or not is specified in the feature spec. A feature ID is essential to be able to customize the configuration of a specific feature.</p>
</div>
<div class="paragraph">
<p>Feature ID consists of a feature spec name plus one or more feature parameters. Feature parameters that are a part of the feature ID include <strong>feature-id="true"</strong> attribute in their descriptions (and cannot be nillable). For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="feature1"&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="b" default="bb"/&gt;
     &lt;param name="c" nillable="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if a config includes multiple features of the spec <strong>feature1</strong>, they could be refered to by <strong>feature1:name=<em>unique_name</em></strong>, where the <em>unique_name</em> is the value of the parameter <strong>name</strong> of the corresponding feature.</p>
</div>
<div class="paragraph">
<p>Feature ID parameters cannot change values during config customizations. If a user wants to have a different value for an ID parameter of a certain feature, the existing feature has to be excluded from the config and a new feature with the desired ID parameter value has to be added in.</p>
</div>
<div class="paragraph">
<p>Here is an example of a feature spec with multiple feature ID parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="feature2"&gt;
   &lt;params&gt;
     &lt;param name="p1" feature-id="true"/&gt;
     &lt;param name="p2" feature-id="true"/&gt;
     &lt;param name="p3" nillable="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>An ID of a feature of this spec will look like <strong>feature2:p1=<em>p1_value</em>,p2=<em>p2_value</em></strong>. The order of the ID parameters is not significant.</p>
</div>
</div>
<div class="sect4">
<h5 id="_feature_parameters">Feature parameters</h5>
<div class="paragraph">
<p>Feature parameters are described in feature specs. A parameter is identified by its name (which must be unique in the scope of the feature spec) and may have the following attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>required string <strong>name</strong> - the name of the parameter;</p>
</li>
<li>
<p>optional boolean <strong>feature-id</strong> - indicating whether the parameter is a part of the feature ID (if not present, the default is assumed to be <strong>false</strong>);</p>
</li>
<li>
<p>optional boolean <strong>nillable</strong> - indicating whether the parameter allows null as the value in the resolved config (if not present, the default is assumed to be <strong>false</strong>);</p>
</li>
<li>
<p>optional string <strong>default</strong> - indicates which value should be used for the parameter, if the parameter was not explicitly initialized in the configuration (if not present, the default is assumed to be <strong>null</strong>).</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="feature1"&gt;
   &lt;params&gt;
     &lt;param name="a" feature-id="true"/&gt;
     &lt;param name="b" default="bb"/&gt;
     &lt;param name="c" nillable="true"/&gt;
     &lt;param name="d"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this spec</p>
</div>
<div class="ulist">
<ul>
<li>
<p>parameter <strong>a</strong> is a feature ID parameter, cannot be null and must be explicitly initialized in the configuration;</p>
</li>
<li>
<p>parameter <strong>b</strong> will have a default value of <em>bb</em> unless explicitly initialized;</p>
</li>
<li>
<p>parameter <strong>c</strong> has not default and may be left uninitialized in the configuration;</p>
</li>
<li>
<p>parameter <strong>d</strong> must be explicitly initialized in the configuration.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_features_in_a_configuration">Features in a configuration</h5>
<div class="paragraph">
<p>This is just an example of how features can be used in a configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0"&gt;
   &lt;config&gt;
     &lt;feature spec="feature1"&gt;
       &lt;param name="a" value="a1"/&gt;
       &lt;param name="b" value="b1"/&gt;
       &lt;param name="d" value="d1"/&gt;
     &lt;/feature&gt;
     &lt;feature spec="feature1"&gt;
       &lt;param name="a" value="a2"/&gt;
       &lt;param name="d" value="d2"/&gt;
     &lt;/feature&gt;
     &lt;feature spec="feature1"&gt;
       &lt;param name="a" value="a3"/&gt;
       &lt;param name="c" value="c3"/&gt;
       &lt;param name="d" value="d3"/&gt;
     &lt;/feature&gt;
   &lt;/config&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <strong>config</strong> element describes the default configuration which will be generated when <strong>fp1</strong> is installed (unless it is explicitly customized by the user), which includes three features of the same spec. When the final configuration is generated, the features will be processed in the order they appear in the <strong>config</strong> element.</p>
</div>
</div>
<div class="sect4">
<h5 id="_feature_references">Feature references</h5>
<div class="paragraph">
<p><a id="feature-refs"></a>There are cases when a value range of a parameter of one feature spec is defined by a set of existing in the configuration model values of an ID parameter from another feature spec. In other words, a feature spec may declare certain parameters as references to other feature ID parameters. (In a relational database, this would be a foreign key reference).</p>
</div>
<div class="paragraph">
<p>In a feature spec a simple feature reference would look like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureC"&gt;
   &lt;refs&gt;
     &lt;ref feature="featureP"/&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="p"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Attribute <strong>feature</strong> in the <strong>ref</strong> element contains a name of the referenced feature-spec. Note that we have not provided which parameter of <strong>featureC</strong> references the ID parameter of <strong>featureP</strong>. This example also demonstrates the <strong>implicit reference parameter mapping</strong>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The implicit reference parameter mapping rule is based on the expectation that the feature spec declaring a reference includes parameters with the names matching the ID parameter names of the referenced feature spec.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So the example above will work if one of the following statements is true:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>featureP</strong> declares parameter <strong>p</strong> and it is its only feature-id parameter;</p>
</li>
<li>
<p><strong>featureP</strong> declares parameter <strong>name</strong> and it is its only feature-id parameter;</p>
</li>
<li>
<p><strong>featureP</strong> declares parameters <strong>name</strong> and <strong>p</strong> and both of them are its only feature-id parameters.</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all">
<caption class="title">Table 1. The complete set of a feature reference declaration attributes</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute name</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dependency</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null (current feature-pack)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The feature-pack dependency name the referenced feature spec belongs to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>feature</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the referenced feature spec.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the <strong>feature</strong> attribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique feature reference name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>nillable</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether a reference is nillable or not.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>include</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the referenced feature should automatically be included into the config model if it was not explicitly configured.</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="_custom_reference_parameter_mapping">Custom reference parameter mapping</h6>
<div class="paragraph">
<p>Suppose we want to explicitly map parameters in the reference declaration. The example below will correspond to the statement 1. from the example above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureC"&gt;
   &lt;refs&gt;
     &lt;ref feature="featureP"&gt;
       &lt;param name="p" maps-to="p"/&gt;
     &lt;/ref&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="p"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s suppose that <strong>featureP</strong>'s ID parameter is in fact <strong>name</strong> but we still want to use parameter <strong>p</strong> as the reference to <strong>featureP</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureC"&gt;
   &lt;refs&gt;
     &lt;ref feature="featureP"&gt;
       &lt;param name="p" maps-to="name"/&gt;
     &lt;/ref&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="p"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <strong>featureP</strong> had more than one ID parameter, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureP"&gt;
   &lt;params&gt;
     &lt;param name="id1" feature-id="true"/&gt;
     &lt;param name="id2" feature-id="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the reference parameter mapping in <strong>featureC</strong> could look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureC"&gt;
   &lt;refs&gt;
     &lt;ref feature="featureP"&gt;
       &lt;param name="p1" maps-to="id1"/&gt;
       &lt;param name="p2" maps-to="id2"/&gt;
     &lt;/ref&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="p1"/&gt;
     &lt;param name="p2"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_nillable_feature_references">Nillable feature references</h6>
<div class="paragraph">
<p>Feature reference resolves to null if one of the feature reference parameters is null. If a reference resolves to null and its not marked as nillable in the feature spec, the provisioning will fail with an error. Here is an example of a nillable reference declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureC"&gt;
   &lt;refs&gt;
     &lt;ref feature="featureP" nillable="true"&gt;
       &lt;param name="p1" maps-to="id1"/&gt;
       &lt;param name="p2" maps-to="id2"/&gt;
     &lt;/ref&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="p1" nillable="true"/&gt;
     &lt;param name="p2"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_external_feature_references">External feature references</h6>
<div class="paragraph">
<p>A feature may reference a feature from another feature-pack. The origin of the external feature spec is specified in the <strong>dependency</strong> attribute of the feature reference declaration. The value of the <strong>dependency</strong> attribute must match the value of the <strong>name</strong> element of the feature-pack dependency (the referenced feature spec belongs to) declaration in the feature-pack.xml file.</p>
</div>
<div class="paragraph">
<p>For example, suppose, feature-pack <strong>fp1</strong> depends on feature-pack <strong>fp2</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0"&gt;
    &lt;dependencies&gt;
        &lt;dependency groupId="org.jboss.pm.test" artifactId="fp2" version="2.0.0"&gt;
            &lt;name&gt;fp2-dep&lt;/name&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>fp2</strong> includes a feature spec <strong>featureP</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureP"&gt;
   &lt;params&gt;
     &lt;param name="p" feature-id="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And <strong>fp1</strong> includes a feature spec <strong>featureC</strong> which declares a reference to <strong>featureP</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureC"&gt;
   &lt;refs&gt;
     &lt;ref dependency="fp2-dep" feature="featureP"/&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="p"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_implicit_feature_reference_parameter_initialization">Implicit feature reference parameter initialization</h6>
<div class="paragraph">
<p><a id="feature-fk-init"></a>Let&#8217;s suppose we have a parent-child relationship between two feature specs, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureP"&gt;
   &lt;params&gt;
     &lt;param name="parentId" feature-id="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureC"&gt;
   &lt;refs&gt;
     &lt;ref feature="featureP"/&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="childId" feature-id="true"/&gt;
     &lt;param name="parentId"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we were to add features of these specs to a config, it could look like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;config&gt;
   &lt;feature spec="featureP"&gt;
     &lt;param name="parentId" value="parent1"/&gt;
   &lt;/feature&gt;
   &lt;feature spec="featureC"&gt;
     &lt;param name="childId" value="child1"/&gt;
     &lt;param name="parentId" value="parent1"/&gt;
   &lt;/feature&gt;
 &lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach is very verbose, the value for the <strong>parentId</strong> parameter is set on every feature. There is a more compact way of expressing the same configuration using nesting, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;config&gt;
   &lt;feature spec="featureP"&gt;
     &lt;param name="parentId" value="parent1"/&gt;
     &lt;feature spec="featureC"&gt;
       &lt;param name="childId" value="child1"/&gt;
     &lt;/feature&gt;
   &lt;/feature&gt;
 &lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen, the <strong>parentId</strong> parameter is initialized only once on the parent feature. The <strong>parentId</strong> of the child feature will be implicitly initialized to the value of the <strong>parentId</strong> of the parent.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When a feature is nested, the tool will look in the feature spec of the nested feature for a reference declaration with the name matching the outer feature spec and, if it is found, the tool will resolve the reference parameter mappings and will initialize the parameters of the child feature referencing the parent.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In case the reference name is different from the referenced feature spec name, i.e. it was explicitly set in the reference spec, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureC"&gt;
   &lt;refs&gt;
     &lt;ref feature="featureP" name="parent"/&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="childId" feature-id="true"/&gt;
     &lt;param name="parentId"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the name of the reference has to be explicitly specified when the child feature is nested using the <strong>parent-ref</strong> attribute, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;config&gt;
   &lt;feature spec="featureP"&gt;
     &lt;param name="parentId" value="parent1"/&gt;
     &lt;feature spec="featureC" parent-ref="parent"&gt;
       &lt;param name="childId" value="child1"/&gt;
     &lt;/feature&gt;
   &lt;/feature&gt;
 &lt;/config&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
it is also possible to <a href="#fg-in-features">include a feature-group as a child of the feature</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_implicit_inclusion_of_referenced_features_into_the_configuration">Implicit inclusion of referenced features into the configuration</h6>
<div class="paragraph">
<p>It is possible to configure feature references so that when the resolved referenced feature ID is not found in the configuration model, instead of failing with the referential integrity constraint error, implicitly include the referenced feature into the configuration model initializing it its configured default values. This is done by simply setting the <strong>include</strong> attribute of the feature reference declaration to <strong>true</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureC"&gt;
   &lt;refs&gt;
     &lt;ref dependency="fp2-dep" feature="featureP" include="true"/&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="p"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_multiple_references_to_the_same_feature_spec">Multiple references to the same feature spec</h6>
<div class="paragraph">
<p>Suppose a feature needs to declare more than one reference to the same feature spec. For example let&#8217;s model a chain having a feature spec called <strong>link</strong>. The <strong>link</strong> must have an ID parameter, let it be called <strong>id</strong>. Then it has to include a parameter to reference to the previous link and another parameter to reference the next link in the chain. The following, although looking right from the parameter mapping perspective, will clearly won&#8217;t work</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="link"&gt;
   &lt;refs&gt;
     &lt;ref feature="link"&gt;
       &lt;param name="prev-id" maps-to="id"/&gt;
     &lt;/ref&gt;
     &lt;ref feature="link"&gt;
       &lt;param name="next-id" maps-to="id"/&gt;
     &lt;/ref&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="id" feature-id="true"/&gt;
     &lt;param name="prev-id" nillable="true"/&gt;
     &lt;param name="next-id" nillable="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Feature references must have a unique name. In this case, both reference names are set to <strong>link</strong> and the provisioning tool will fail to process this spec. To workaround the error explicit names have to be assigned to the reference declarations, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="link"&gt;
   &lt;refs&gt;
     &lt;ref name="prev" feature="link"&gt;
       &lt;param name="prev-id" maps-to="id"/&gt;
     &lt;/ref&gt;
     &lt;ref name="next" feature="link"&gt;
       &lt;param name="next-id" maps-to="id"/&gt;
     &lt;/ref&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="id" feature-id="true"/&gt;
     &lt;param name="prev-id" nillable="true"/&gt;
     &lt;param name="next-id" nillable="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_processing_of_features_with_references">Processing of features with references</h6>
<div class="paragraph">
<p>One of the responsibilities of the provisioning tool is to order the features from the resolve configuration model for processing by the provisioning plugins that generate the final installation configuration files. While the general rule is to preserve the order in which the features where added to the configuration model, when feature A references feature B, feature B will get the priority will be processed by the provisioning plugins before feature A to not break the referential integrity of the generated model (if it is significant for the consuming plugin).</p>
</div>
</div>
<div class="sect5">
<h6 id="_circular_feature_references">Circular feature references</h6>
<div class="paragraph">
<p>The provisioning mechanism is capable of identifying circular references (circular reference graphs). It does not throw an error if a circular reference graphs is detected. The responsibility of the provisioning mechanism is make sure the configuration model is valid and all the referential integrity constraints are satisfied. From this point of view circular references are not illegal.</p>
</div>
<div class="paragraph">
<p>The issue with circular references is the ordering of the features when configuration model is processed by the product specific plugins that generate the final configuration files. In some cases the order of the features will not be significant but in some cases it will be. So the rule is</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When a circular reference graph is identified, the feature that was added to the configuration model first will be processed by the provisioning plugins first, the rest of the features from the grapth will be processed respecting the references.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_feature_dependencies">Feature dependencies</h5>
<div class="paragraph">
<p><a id="feature-deps"></a>While references are a kind of dependencies, they require parameters in the spec of the feature declaring the reference to identify the target. Unlike references, feature dependencies do not use the parameters to specify the target. Instead the dependency is declared by specifying the ID of the target feature directly.</p>
</div>
<div class="sect5">
<h6 id="_feature_spec_dependencies">Feature spec dependencies</h6>
<div class="paragraph">
<p>Feature dependencies can be declared in the feature spec and/or on the feature itself. Here is an example of a dependency declaration in the feature spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="feature1"&gt;
   &lt;deps&gt;
     &lt;dep feature-id="feature2:id=123"/&gt;
   &lt;/deps&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now all the features of the spec <strong>feature1</strong> will depend on the feature with ID <code>feature2:id=123</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_feature_config_dependencies">Feature config dependencies</h6>
<div class="paragraph">
<p>And here is how a feature dependency can be declared on a specific feature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature spec="feature1"&gt;
   &lt;deps&gt;
     &lt;dep feature-id="feature3:id=789"/&gt;
   &lt;/deps&gt;
   &lt;param name="name" value="abc"/&gt;
 &lt;/feature&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now feature <code>feature1:name=abc</code> depends on the feature <code>feature2:id=123</code> (inherited dependency from the spec) and the feature <code>feature3:id=789</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_external_feature_dependencies">External feature dependencies</h6>
<div class="paragraph">
<p>If the <strong>feature3</strong> spec was from another feature-pack than the <strong>feature1</strong> spec then we&#8217;d have to add the origin of the <strong>feature3</strong> spec to the dependency declaration. Assuming that the feature-pack the <strong>feature1</strong> spec belongs to declared a dependecy named <strong>fp2</strong> on the feature-pack the <strong>feature3</strong> spec belongs to, the dependency declaration will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature spec="feature1"&gt;
   &lt;deps&gt;
     &lt;dep feature-id="feature3:id=789" dependency="fp2"/&gt;
   &lt;/deps&gt;
   &lt;param name="name" value="abc"/&gt;
 &lt;/feature&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_implicit_inclusion_of_feature_dependencies">Implicit inclusion of feature dependencies</h6>
<div class="paragraph">
<p>Like references, dependencies also support the <strong>include</strong> attribute. If the dependency is declared with the <strong>include=true</strong>, the target of the dependency will implicitly be included into the configuration unless it is already present. Here is an example of an implicitly included feature dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature spec="feature1"&gt;
   &lt;deps&gt;
     &lt;dep feature-id="feature3:id=789" include="true"/&gt;
   &lt;/deps&gt;
   &lt;param name="name" value="abc"/&gt;
 &lt;/feature&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_feature_capabilities">Feature capabilities</h5>
<div class="paragraph">
<p><a id="caps"></a>In the actual provisioned product, the components that are represented as features in the configuration model may provide certain runtime capabilities that other components also represented as features in the configuration model may depend upon. There two reasons why this <strong>may</strong> be important when resolving the configuration model for the installation to be provisioned:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>to make sure that the configuration is consistent in a sense that the runtime requirements of its components are satisfied;</p>
</li>
<li>
<p>to order the features in the configuration model for processing by the provisioning plugins based on their dependencies and runtime requirements.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Capabilities are represented as strings with a dot serving as a word separator. Here is an example of a feature providing a capability:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec name="interface" xmlns="urn:wildfly:pm-feature-spec:1.0"&gt;
   &lt;provides&gt;
     &lt;capability name="org.wildfly.network.interface"/&gt;
   &lt;/provides&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="inet-address"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is a feature that expresses a requirement on the capability provided above</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec name="socket-binding" xmlns="urn:wildfly:pm-feature-spec:1.0"&gt;
   &lt;requires&gt;
     &lt;capability name="org.wildfly.network.interface"/&gt;
   &lt;/requires&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="port"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the examples above the capabilities were configured using constants. This type of a capability is called a <strong>static capability</strong>. As a consequence, all the features of the <strong>interface</strong> spec will provide the same capability <code>org.wildfly.network.interface</code>. And all the features of the <strong>socket-binding</strong> spec will require the same capabality <code>org.wildfly.network.interface</code>.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_dynamic_capabilities">Dynamic capabilities</h6>
<div class="paragraph">
<p>It is also possible, however, to provide or require a capability that depends on the parameters of a specific feature. Dynamic capabilities are following the same dot-separated string format but include feature parameters names prefixed with the <code>$</code> character. The examples above could be enhanced with dynamic capabilities as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec name="interface" xmlns="urn:wildfly:pm-feature-spec:1.0"&gt;
   &lt;provides&gt;
     &lt;capability name="org.wildfly.network.interface.$name"/&gt;
   &lt;/provides&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="inet-address" nillable="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec name="socket-binding" xmlns="urn:wildfly:pm-feature-spec:1.0"&gt;
   &lt;requires&gt;
     &lt;capability name="org.wildfly.network.interface.$interface"/&gt;
   &lt;/requires&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="interface"/&gt;
     &lt;param name="port" nillable="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s see how it will look like in an actual configuration</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0"&gt;
   &lt;config&gt;
     &lt;feature spec="interface"&gt;
       &lt;param name="name" value="public"/&gt;
     &lt;/feature&gt;
     &lt;feature spec="interface"&gt;
       &lt;param name="name" value="secure"/&gt;
     &lt;/feature&gt;
     &lt;feature spec="socket-binding"&gt;
       &lt;param name="name" value="http"/&gt;
       &lt;param name="interface" value="public"/&gt;
     &lt;/feature&gt;
     &lt;feature spec="socket-binding"&gt;
       &lt;param name="name" value="https"/&gt;
       &lt;param name="interface" value="secure"/&gt;
     &lt;/feature&gt;
   &lt;/config&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above feature <em>interface:name=public</em> provides capability <em>org.wildfly.network.interface.public</em> which is required by feature <em>socket-binding:name=http</em>. And feature <em>interface:name=secure</em> provides capability <em>org.wildfly.network.interface.secure</em> which is required by feature <em>socket-binding:name=https</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
More than one parameter could be used in a capability name. The parameters may appear in any part of the name, not necessarily at the end as in the example. The only rule is to use the dot as a separator for the parameters and the static parts of the name.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_feature_package_dependencies">Feature package dependencies</h5>
<div class="paragraph">
<p><a id="feature-package-deps"></a>Feature specs representing configurable components of the installation may include dependencies on the feature-pack packages that contain the binaries of those installation components. So that, when a feature is included into a configuration, the packages it declared dependencies on will implicitly be added to the list of the installed packages.</p>
</div>
<div class="paragraph">
<p>Package dependencies are configured under the <strong>packages</strong> element of the feature spec which is equivalent to the <a href="#package-deps"><strong>dependencies</strong> element of the package spec metadata</a>. Here is an example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec name="feature1" xmlns="urn:wildfly:pm-feature-spec:1.0"&gt;
   &lt;params&gt;
     &lt;param name="id" feature-id="true"/&gt;
   &lt;/params&gt;
   &lt;packages&gt;
     &lt;package name="p1"/&gt;
     &lt;package name="p2" optional="true"/&gt;
     &lt;feature-pack dependency="another-feature-pack"&gt;
       &lt;package name="p2"/&gt;
       &lt;package name="p3" optional="true"/&gt;
     &lt;/feature-pack&gt;
   &lt;/packages&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, a feature of the <strong>feature1</strong> spec will have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a required dependency on the package <strong>p1</strong>;</p>
</li>
<li>
<p>an optional dependency on the package <strong>p2</strong>;</p>
</li>
<li>
<p>a required dependency on the package <strong>p2</strong> from the feature-pack dependency refered to as <strong>another-feature-pack</strong>;</p>
</li>
<li>
<p>an optional dependency on the package <strong>p3</strong> from the feature-pack dependency refered to as <strong>another-feature-pack</strong>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_feature_annotations">Feature annotations</h5>
<div class="paragraph">
<p><a id="feature-annotations"></a>Feature specs may include a list of annotations. The provisioning mechanism does not include pre-defined annotations yet and does not use them for processing features and configurations. Annotations are simply parsed and attached to feature specs and made available to the provisioning plugins for processing. Here is an example of an annotated feature spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="feature1"&gt;
   &lt;annotation name="name1"&gt;
     &lt;elem name="elem1" value="value1"/&gt;
   &lt;/annotation&gt;
   &lt;annotation name="name2"&gt;
     &lt;elem name="elem1" value="value1"/&gt;
     &lt;elem name="elem1" value="value1"/&gt;
   &lt;/annotation&gt;
   &lt;params&gt;
     &lt;param name="id" feature-id="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_feature_groups">4.1.2. Feature groups</h4>
<div class="paragraph">
<p>A feature represents a minimal configuration unit. When a configuration model reaches a certain level of complexity though, using and manipulating features to define the final configuration may become impractical.
Feature groups allow to group a set of features that represent a certain part of the configuration together and then later include them all into the final configuration as a group. For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-group-spec name="group1" xmlns="urn:wildfly:pm-feature-group:1.0"&gt;
   &lt;feature spec="feature1"&gt;
     &lt;param name="id" value="a1"/&gt;
     &lt;feature spec="feature2"&gt;
       &lt;param name="id" value="b1"/&gt;
     &lt;/feature&gt;
   &lt;/feature&gt;
   &lt;feature spec="feature3"&gt;
     &lt;param name="id" value="c1"/&gt;
   &lt;/feature&gt;
 &lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0"&gt;
   &lt;config&gt;
     &lt;feature-group name="group1"/&gt;
   &lt;/config&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>First, we defined a feature group named <strong>group1</strong> which includes three features. The name of the group must be unique in the scope of the feature-pack. Feature groups are saved in the feature-pack&#8217;s <code>feature_groups</code> directory in XML files named after the feature groups (<strong>group1.xml</strong> in this example).</p>
</div>
<div class="paragraph">
<p>Then in the default configuration of the feature-pack we simply included the <strong>group1</strong>.</p>
</div>
<div class="paragraph">
<p>Besides features, feature groups may also include other feature groups. Continuing the example above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-group-spec name="group2" xmlns="urn:wildfly:pm-feature-group:1.0"&gt;
   &lt;feature-group name="group1"/&gt;
   &lt;feature spec="feature4"&gt;
     &lt;param name="id" value="d1"/&gt;
   &lt;/feature&gt;
 &lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
                groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0"&gt;
   &lt;config&gt;
     &lt;feature-group name="group2"/&gt;
   &lt;/config&gt;
 &lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The final configuration will now include all the four features. The order of the features in the resolved configuration will reflect the order in which the features were included into the configuration but also respecting the feature references and the dependencies, i.e.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>feature1:id=a1</em></p>
</li>
<li>
<p><em>feature2:id=b1</em></p>
</li>
<li>
<p><em>feature3:id=c1</em></p>
</li>
<li>
<p><em>feature4:id=d1</em></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_including_customized_feature_groups">Including customized feature groups</h5>
<div class="paragraph">
<p>When a feature group is included (into another feature group or the <strong>config</strong> element of the feature-pack configuration) the set of its features can be customized. There are two main kinds of customizations that are allowed when including a feature group:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#feature-param-overwrites">the configuration of the features included into the group can be overwritten</a>;</p>
</li>
<li>
<p>certain features can be excluded from the group by</p>
<div class="ulist">
<ul>
<li>
<p><a href="#fg-exclude-features-by-ids">specifying the feature IDs</a>;</p>
</li>
<li>
<p><a href="#fg-exclude-features-by-specs">specifying the specs features of which have to be excluded</a>;</p>
</li>
<li>
<p><a href="#fg-include-features-by-ids">explicitly choosing which features should be included by specifying their feature IDs</a>;</p>
</li>
<li>
<p><a href="#fg-include-features-by-specs">explicitly choosing features of which feature specs should be included</a>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When a feature group is included into another feature group or a <strong>config</strong>, the list of its direct entries (features and feature groups) defined by the feature group spec cannot be extended by applying customizations. <a href="#fg-indirect-ext">There is a way though to extend the feature set of the included feature group indirectly</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All the feature group customizations are expressed in the body of the <code>feature-group</code> XML element.</p>
</div>
<div class="sect5">
<h6 id="_overwriting_parameters_of_features_from_a_feature_group">Overwriting parameters of features from a feature group</h6>
<div class="paragraph">
<p><a id="feature-param-overwrites"></a>The configuration of a feature can be customized by adding the <code>include</code> element with the <code>feature-id</code> attribute targeting its ID to the body of the <code>feature-group</code> element. E.g. suppose this is our feature spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="feature1"&gt;
  &lt;params&gt;
    &lt;param name="a" feature-id="true"/&gt;
    &lt;param name="b" default="bb"/&gt;
    &lt;param name="c" nillable="true"/&gt;
    &lt;param name="d"/&gt;
  &lt;/params&gt;
&lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is our feature group spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:wildfly:pm-feature-group:1.0"&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="a" value="a1"/&gt;
    &lt;param name="c" value="group1"/&gt;
    &lt;param name="d" value="group1"/&gt;
  &lt;/feature&gt;
&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And this is our config:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config&gt;
  &lt;feature-group name="group1"&gt;
    &lt;include feature-id="feature1:a=a1"&gt;
      &lt;param name="d" value="config"/&gt;
    &lt;/include&gt;
  &lt;/feature-group&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resolved configuration will consist of one feature with the following configuration</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
<th class="tableblock halign-left valign-top">c</th>
<th class="tableblock halign-left valign-top">d</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Let&#8217;s now suppose that we have two feature specs with a parent-child relationship</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureP"&gt;
  &lt;params&gt;
    &lt;param name="parent" feature-id="true"/&gt;
  &lt;/params&gt;
&lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureC"&gt;
  &lt;refs&gt;
    &lt;ref feature="featureP"&gt;
  &lt;/refs&gt;
  &lt;params&gt;
    &lt;param name="parent" feature-id="true"/&gt;
    &lt;param name="child" feature-id="true"/&gt;
    &lt;param name="a"/&gt;
    &lt;param name="b"/&gt;
  &lt;/params&gt;
&lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The group spec is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:wildfly:pm-feature-group:1.0"&gt;
  &lt;feature spec="featureP"&gt;
    &lt;param name="parent" value="p1"/&gt;
    &lt;feature spec="featureC"&gt;
      &lt;param name="child" value="c1"/&gt;
      &lt;param name="a" value="group1"/&gt;
      &lt;param name="b" value="group1"/&gt;
    &lt;/feature&gt;
  &lt;/feature&gt;
&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we want to customize the child feature when including the <strong>group1</strong> into the config.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config&gt;
  &lt;feature-group name="group1"&gt;
    &lt;include feature-id="featureC:parent=p1,child=c1"&gt;
      &lt;param name="b" value="config"/&gt;
    &lt;/include&gt;
  &lt;/feature-group&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resolved configuration will contain two features:</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">parent</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">featureP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p1</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">child</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">featureC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_excluding_features_from_a_group_by_ids">Excluding features from a group by IDs</h6>
<div class="paragraph">
<p><a id="fg-exclude-features-by-ids"></a>When a feature group is included into another group or a config, certain features can be excluded from the included feature set by simply specifying their IDs.</p>
</div>
<div class="paragraph">
<p>Suppose, we have the following group spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:wildfly:pm-feature-group:1.0"&gt;

  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="a1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="a2"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="b1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="b2"/&gt;
  &lt;/feature&gt;


&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is how <strong>feature1:id=a1</strong> and <strong>feature2:id=b1</strong> can be excluded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config&gt;
  &lt;feature-group name="group1"&gt;
    &lt;exclude feature-id="feature1:id=a1"/&gt;
    &lt;exclude feature-id="feature2:id=b1"/&gt;
  &lt;/feature-group&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The config will include <strong>feature1:id=a2</strong> and <strong>feature2:id=b2</strong>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_excluding_features_from_a_group_by_specs">Excluding features from a group by specs</h6>
<div class="paragraph">
<p><a id="fg-exclude-features-by-specs"></a>When a feature group is included into another group or a config, all the features of a specific feature spec can be excluded from the included feature set by simply specifying the feature spec.</p>
</div>
<div class="paragraph">
<p>Suppose, we have the following group spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:wildfly:pm-feature-group:1.0"&gt;

  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="a1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="a2"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="b1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="b2"/&gt;
  &lt;/feature&gt;


&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is how all the feature of the <strong>feature1</strong> spec can be excluded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config&gt;
  &lt;feature-group name="group1"&gt;
    &lt;exclude spec="feature1"/&gt;
  &lt;/feature-group&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The config will include <strong>feature2:id=b1</strong> and <strong>feature2:id=b2</strong>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_picking_features_from_a_group_by_ids">Picking features from a group by IDs</h6>
<div class="paragraph">
<p><a id="fg-include-features-by-ids"></a>When a feature group is included into another group or a config, by default all the features it contains are included but it is also possible to pick which ones exactly should be included.</p>
</div>
<div class="paragraph">
<p>Suppose, we have the following group spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:wildfly:pm-feature-group:1.0"&gt;

  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="a1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="a2"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="b1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="b2"/&gt;
  &lt;/feature&gt;


&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is how <strong>feature1:id=a1</strong> and <strong>feature2:id=b1</strong> can be picked into the config:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config&gt;
  &lt;feature-group name="group1" inherit-features="false"&gt;
    &lt;include feature-id="feature1:id=a1"/&gt;
    &lt;include feature-id="feature2:id=b1"/&gt;
  &lt;/feature-group&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>inherit-features</code> attribute indicates whether the whole feature set of the group should be included into the config or not. If this attribute is not specified, its value is assumed to be true.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then the <code>include</code> elements are picking the features that need to be included by their IDs.</p>
</div>
<div class="paragraph">
<p>The config will include <strong>feature1:id=a1</strong> and <strong>feature2:id=b1</strong>.</p>
</div>
<div class="paragraph">
<p>The <code>include</code> elements can also be used to pick features from the excluded feature specs. The config below is equivalent to the config above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config&gt;
  &lt;feature-group name="group1" inherit-features="true"&gt;
    &lt;exclude spec="feature1"/&gt;
    &lt;exclude spec="feature2"/&gt;
    &lt;include feature-id="feature1:id=a1"/&gt;
    &lt;include feature-id="feature2:id=b1"/&gt;
  &lt;/feature-group&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_including_features_of_specific_feature_specs_from_a_group">Including features of specific feature specs from a group</h6>
<div class="paragraph">
<p><a id="fg-include-features-by-specs"></a>When a feature group is included into another group or a config, by default all the features it contains are included but it is also possible to pick features of which feature specs should be included.</p>
</div>
<div class="paragraph">
<p>Suppose, we have the following group spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:wildfly:pm-feature-group:1.0"&gt;

  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="a1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="a2"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="b1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="feature2"&gt;
    &lt;param name="id" value="b2"/&gt;
  &lt;/feature&gt;


&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is how all the features of <strong>feature1</strong> can be included into the config:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config&gt;
  &lt;feature-group name="group1" inherit-features="false"&gt;
    &lt;include spec="feature1"/&gt;
  &lt;/feature-group&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>inherit-features</code> attribute indicates whether the whole feature set of the group should be included into the config or not. If this attribute is not specified, its value is assumed to be true.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then the <code>include</code> element is specifying the feature spec features of which should be included into the config.</p>
</div>
<div class="paragraph">
<p>The config will include <strong>feature1:id=a1</strong> and <strong>feature1:id=a2</strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>&lt;exclude feature-id="xxx"/&gt;</code> elements can be used to exclude certain features from the feature set of the included feature spec.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_extending_feature_groups_by_including_features_indirectly">Extending feature groups by including features indirectly</h6>
<div class="paragraph">
<p><a id="fg-indirect-ext"></a>While the list of the feature group spec enrties (features and feature groups) is fixed and cannot be extended, new features and feature groups can be added as children of the features that have already been included into the feature group.
Let&#8217;s edit the example from the previous paragraph to demonstrate that. The feature specs will remain the same.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureP"&gt;
  &lt;params&gt;
    &lt;param name="parent" feature-id="true"/&gt;
  &lt;/params&gt;
&lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureC"&gt;
  &lt;refs&gt;
    &lt;ref feature="featureP"&gt;
  &lt;/refs&gt;
  &lt;params&gt;
    &lt;param name="parent" feature-id="true"/&gt;
    &lt;param name="child" feature-id="true"/&gt;
    &lt;param name="a"/&gt;
    &lt;param name="b"/&gt;
  &lt;/params&gt;
&lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The group spec will now include only parent feature</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:wildfly:pm-feature-group:1.0"&gt;
  &lt;feature spec="featureP"&gt;
    &lt;param name="parent" value="p1"/&gt;
  &lt;/feature&gt;
&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And now we will include the child feature as a configuration customization of the parent feature.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config&gt;
  &lt;feature-group name="group1"&gt;
    &lt;include feature-id="featureP:parent=p1"&gt;
      &lt;feature spec="featureC"&gt;
        &lt;param name="child" value="c1"/&gt;
        &lt;param name="a" value="config"/&gt;
        &lt;param name="b" value="config"/&gt;
      &lt;/feature&gt;
    &lt;/include&gt;
  &lt;/feature-group&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resolved configuration will contain the two features:</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">parent</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">featureP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p1</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">parent</th>
<th class="tableblock halign-left valign-top">child</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">featureC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_including_features_and_feature_groups_from_other_feature_packs">Including features and feature groups from other feature-packs</h5>
<div class="paragraph">
<p>Feature groups, as well as <strong>config</strong> elements in the <strong>feature-pack.xml</strong>, may include features and feature groups from other feature-packs. This is done by including one or more <code>feature-pack</code> element and specifying the origin of the included features and feature groups in its <code>dependency</code> attribute. For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:wildfly:pm-feature-group:1.0"&gt;

  &lt;feature spec="feature1"&gt;
    &lt;param name="id" value="a1"/&gt;
  &lt;/feature&gt;

  &lt;feature-pack dependency="another-feature-pack"&gt;
    &lt;feature-group name="group2"/&gt;
    &lt;feature spec="feature2"&gt;
      &lt;param name="id" value="b1"/&gt;
    &lt;/feature&gt;
  &lt;/feature-pack&gt;

  &lt;feature-group name="group3"/&gt;

  &lt;feature-pack dependency="another-feature-pack"&gt;
    &lt;feature-group name="group3"/&gt;
  &lt;/feature-pack&gt;

&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the order of the features in the resolved feature group will be</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>feature1:id=a1</em> from the local feature-pack;</p>
</li>
<li>
<p>features from <em>group2</em> from <strong>another-feature-pack</strong>;</p>
</li>
<li>
<p><em>feature2:id=b1</em> from <strong>another-feature-pack</strong>;</p>
</li>
<li>
<p>features from <em>group3</em> from the local feature-pack;</p>
</li>
<li>
<p>features from <em>group3</em> from <strong>another-feature-pack</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_nesting_feature_groups_under_features">Nesting feature groups under features</h5>
<div class="paragraph">
<p>It was mentioned in an earlier chapter that a <a href="#feature-fk-init">feature may nest other features that reference it</a>. <a id="fg-in-features"></a>It is also possible to nest a feature group under a feature with the condition that all the features included directly into the spec of the feature group reference the same parent feature.</p>
</div>
<div class="paragraph">
<p>For example, suppose we have a parent spec <strong>featureP</strong> and child spec <strong>featureA</strong> and <strong>featureB</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureP"&gt;
   &lt;params&gt;
     &lt;param name="parent" feature-id="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureA"&gt;
   &lt;refs&gt;
     &lt;ref feature="featureP"/&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="parent" feature-id="true"/&gt;
     &lt;param name="a" feature-id="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureB"&gt;
   &lt;refs&gt;
     &lt;ref feature="featureP"/&gt;
   &lt;/refs&gt;
   &lt;params&gt;
     &lt;param name="parent" feature-id="true"/&gt;
     &lt;param name="b" feature-id="true"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s suppose that there is a group which consists of features of <strong>featureA</strong> and <strong>featureB</strong> specs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:wildfly:pm-feature-group:1.0"&gt;

  &lt;feature spec="featureA"&gt;
    &lt;param name="a" value="a1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="featureB"&gt;
    &lt;param name="id" value="b1"/&gt;
  &lt;/feature&gt;

&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This group can be nested under any instance of <strong>featureP</strong> and the <strong>parent</strong> parameters of the features in the group will implicitly be initialized to the value of the <strong>parent</strong> parameter of the outer <strong>featureP</strong> instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config&gt;
  &lt;feature spec="featureP"&gt;
    &lt;param name="parent" value="p1"/&gt;
    &lt;feature-group name="group1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="featureP"&gt;
    &lt;param name="parent" value="p2"/&gt;
    &lt;feature-group name="group1"/&gt;
  &lt;/feature&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting config will include:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>featureP:parent=p1</em>;</p>
</li>
<li>
<p><em>featureP:parent=p2</em>;</p>
</li>
<li>
<p><em>featureA:parent=p1,a=a1</em>;</p>
</li>
<li>
<p><em>featureA:parent=p2,a=a1</em>;</p>
</li>
<li>
<p><em>featureB:parent=p1,b=b1</em>;</p>
</li>
<li>
<p><em>featureB:parent=p2,b=b1</em>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_merging_feature_groups">Merging feature groups</h5>
<div class="paragraph">
<p>There could be a situation when the same feature group is brought into the config as a dependency of other feature groups. Which means its basic feature set is included multiple times but, taking into account possible customizations, each time it might be slightly different.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In that case the feature configurations will be merged. The features that are included later in the config will overwrite the common parameters of the corresponding features included earlier. But they will not completely replace the feature configurations that were added earlier.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, suppose we have these feature specs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureA"&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="p1" default="feature-spec"/&gt;
     &lt;param name="p2" default="feature-spec"/&gt;
     &lt;param name="p3" default="feature-spec"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;feature-spec xmlns="urn:wildfly:pm-feature-spec:1.0" name="featureB"&gt;
   &lt;params&gt;
     &lt;param name="name" feature-id="true"/&gt;
     &lt;param name="p1" default="feature-spec"/&gt;
     &lt;param name="p2" default="feature-spec"/&gt;
     &lt;param name="p3" default="feature-spec"/&gt;
   &lt;/params&gt;
 &lt;/feature-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and these feature groups</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group1" xmlns="urn:wildfly:pm-feature-group:1.0"&gt;

  &lt;feature spec="featureA"&gt;
    &lt;param name="name" value="a1"/&gt;
    &lt;param name="p1" value="group1"/&gt;
    &lt;param name="p2" value="group1"/&gt;
    &lt;param name="p3" value="group1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="featureA"&gt;
    &lt;param name="name" value="a2"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="featureA"&gt;
    &lt;param name="name" value="a3"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="featureB"&gt;
    &lt;param name="name" value="b1"/&gt;
    &lt;param name="p1" value="gorup1"/&gt;
    &lt;param name="p2" value="group1"/&gt;
    &lt;param name="p3" value="group1"/&gt;
  &lt;/feature&gt;
  &lt;feature spec="featureB"&gt;
    &lt;param name="name" value="b2"/&gt;
  &lt;/feature&gt;

&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group2" xmlns="urn:wildfly:pm-feature-group:1.0"&gt;

  &lt;feature-group name="group1"&gt;
    &lt;include feature-id="featureA:name="a1"&gt;
      &lt;param name="p1" value="group2"/&gt;
      &lt;param name="p2" value="group2"/&gt;
    &lt;/feature&gt;
    &lt;exclude feature-id="featureA:name=a3"/&gt;
    &lt;include feature-id="featureB:name="b1"&gt;
      &lt;param name="p2" value="group2"/&gt;
    &lt;/feature&gt;
    &lt;exclude feature-id="featureB:name=b2"/&gt;
  &lt;/feature-group&gt;

&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-group-spec name="group3" xmlns="urn:wildfly:pm-feature-group:1.0"&gt;

  &lt;feature-group name="group1"&gt;
    &lt;include feature-id="featureA:name="a1"&gt;
      &lt;param name="p1" value="group3"/&gt;
    &lt;/feature&gt;
    &lt;exclude feature-id="featureA:name=a2"/&gt;
    &lt;include feature-id="featureB:name="b1"&gt;
      &lt;param name="p3" value="group3"/&gt;
    &lt;/feature&gt;
    &lt;exclude feature-id="featureB:name=b2"/&gt;
  &lt;/feature-group&gt;

&lt;/feature-group-spec&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now this configuration</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;config&gt;
  &lt;feature-group name="group2"/&gt;
  &lt;feature-group name="group3"/&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>will contain</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">p1</th>
<th class="tableblock halign-left valign-top">p2</th>
<th class="tableblock halign-left valign-top">p3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">featureA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">featureA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature-spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature-spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature-spec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">featureA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature-spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature-spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature-spec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">featureB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">b1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group3</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_model_attributes">4.2. Configuration model attributes</h3>
<div class="paragraph">
<p>Configuration models are described in the <code>feature-pack.xml</code> file under the <code>config</code> elements. A <code>feature-pack.xml</code> file may contain zero, one or more <code>config</code> elements. Each configuration may include the following <strong>optional</strong> attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> - the name of the configuration;</p>
</li>
<li>
<p><code>model</code> - the model name of the configuration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the XML it could look like this (the content of the <code>config</code> elements has been left out as not important in this example):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0"&gt;
  &lt;config&gt;
    &lt;!-- anonymous config --&gt;
  &lt;/config&gt;

  &lt;config name="config1"&gt;
    &lt;!-- named config --&gt;
  &lt;/config&gt;

  &lt;config model="model1"&gt;
    &lt;!-- model1 model-only config --&gt;
  &lt;/config&gt;

  &lt;config model="model1" name="config1"&gt;
    &lt;!-- named model1 config --&gt;
  &lt;/config&gt;

&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>name</code> and <code>model</code> attributes are optional, which means it is well possible to define a configuration w/o those attributes. A feature pack may define zero, one or more anonymous configs.</p>
</div>
<div class="paragraph">
<p>The <code>name</code> and the <code>model</code> attributes serve as an identity of the config model. They are essential when customizing and merging configuration models.</p>
</div>
<div class="paragraph">
<p>If a config is associated only with the name (without the model) then only the name will be used as the identity of the config model. If a config is associated with both the name and the model then a combination of the name and the model will be used as the identity of the config model.</p>
</div>
<div class="paragraph">
<p>In the example above the named config <strong>config1</strong> and the named <strong>model1:config1</strong> config are two unrelated config models.</p>
</div>
<div class="paragraph">
<p>When a feature-pack is installed, by default all the configs defined in its <code>feature-pack.xml</code> are installed. Users may explicitly specify though which configs should the final installation include and customize those and/or provide their own custom configs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_excluding_default_configs_from_the_installation">4.3. Excluding default configs from the installation</h3>
<div class="paragraph">
<p>To be able to exclude a config, it needs to be identifiable. I.e. it must have a <code>name</code> associated with it. If a config doesn&#8217;t have a name it still can be excluded but only altogether with the other configs like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:wildfly:pm-provisioning:1.0"&gt;
    &lt;feature-pack groupId="org.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;

        &lt;default-configs inherit="false"/&gt;

    &lt;/feature-pack&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>inherit="false"</code> attribute indicates that none of the configs should be included into the installation by default. If the attribute is not present, its value is assumed to be true.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>feature-pack</code> element in the example above could as well appear under the <code>dependecies</code> element of another feature pack&#8217;s <strong>feature-pack.xml</strong> file. Meaning the XML type of these elements are equivalent - they both describe a customized feature pack. The examples below will display only the <code>feature-pack</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If a config is a named config which is not associated with any model then it can be excluded by specifying its name, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack groupId="org.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
    &lt;default-configs&gt;
        &lt;exclude name="config1"/&gt;
    &lt;/default-configs&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a config is associated with both the name and the model, both of them have to be specified, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack groupId="org.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
    &lt;default-configs&gt;
        &lt;exclude name="config1" model="model1"/&gt;
    &lt;/default-configs&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case there are multiple named configs that are associated with the same model, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0"&gt;

  &lt;config model="model1" name="config1"&gt;
    &lt;!-- config body --&gt;
  &lt;/config&gt;
  &lt;config model="model1" name="config2"&gt;
    &lt;!-- config body --&gt;
  &lt;/config&gt;

  &lt;config model="model2" name="config1"&gt;
    &lt;!-- config body --&gt;
  &lt;/config&gt;
  &lt;config model="model2" name="config2"&gt;
    &lt;!-- config body --&gt;
  &lt;/config&gt;

&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="excl-configs-by-model"></a>They can be excluded altogether by specifying the model name, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:wildfly:pm-provisioning:1.0"&gt;
    &lt;feature-pack groupId="org.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
        &lt;default-configs&gt;
            &lt;exclude model="model1"/&gt;
        &lt;/default-configs&gt;
    &lt;/feature-pack&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This installation will include configs <strong>model2:config1</strong> and <strong>model2:config2</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_picking_default_configs_into_the_installation">4.4. Picking default configs into the installation</h3>
<div class="paragraph">
<p>There are two scenarios when including a config makes sense:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>when the config was excluded by <code>&lt;exclude model="<em>model_name</em>"/&gt;</code>;</p>
</li>
<li>
<p>when inhertance of the default configs was disabled with <code>&lt;default-configs inherit="false"&gt;</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first one of course assumes that the config is associated with both the name and the model. It could look like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack groupId="org.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
    &lt;default-configs&gt;
        &lt;exclude model="model1"/&gt;
        &lt;include name="config1" model="model1"/&gt;
    &lt;/default-configs&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above excludes all the configs with the <strong>model1</strong> except the <strong>config1</strong>.</p>
</div>
<div class="paragraph">
<p><a id="disable-def-configs"></a>Here is an example for the second scenario</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack groupId="org.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
    &lt;default-configs inherit="false"&gt;
        &lt;include name="config1"/&gt;
        &lt;include name="config1" model="model1"/&gt;
    &lt;/default-configs&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above picks only the <strong>config1</strong> and the <strong>model1:config1</strong> from all the default configs to be included into the installation.</p>
</div>
<div class="paragraph">
<p>It also possible to include the configs of a specific model, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack groupId="org.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
    &lt;default-configs inherit="false"&gt;
        &lt;include model="model1"/&gt;
    &lt;/default-configs&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, all the default configs associated with the <strong>model1</strong> will be included into the installation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_model_merges">4.5. Configuration model merges</h3>
<div class="paragraph">
<p>Configuration model merges is a way to integrate various products into a single installation. Suppose we have an installation and we want to add another product to it. Besides adding the actual filesystem content of the product we are adding to the installation, normally the configuration of the installation will have to be adjusted to include the configuration of the product we are adding to it.</p>
</div>
<div class="paragraph">
<p>In the provisioning terms, this scenarios can be described as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>there is a feature-pack of the main installation (defining its FS content as well as the configuration model);</p>
</li>
<li>
<p>there is the other product&#8217;s feature-pack defining its FS content and the default configuration that should be added to the main installation as part of its integration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>How exactly the configuration of the new product is integrated into the existing installation will depend on every specific case but there are a few basic ways it can happen:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the product comes with its own standalone config which will not affect the existing installation configuration;</p>
</li>
<li>
<p>the product&#8217;s config will have to be added to the existing installation configuration model;</p>
</li>
<li>
<p>a combination of the two above (standalone config and a piece of the config that needs to be added to the existing installation configuration).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first one is simple: we just need to generate two separate configurations: one for each feature-pack.</p>
</div>
<div class="paragraph">
<p>For the second one, we need to merge the configs from both feature-packs and then generate a single confguration.</p>
</div>
<div class="paragraph">
<p>The third one effectively means that we&#8217;ve got multiple configuration models some of which should be merged and some should remain standalone. The tricky part is to identify which one is which. This is where the config <strong>name</strong> and <strong>model</strong> attributes are useful.</p>
</div>
<div class="paragraph">
<p>The provisioned installation may contain only one configuration model of a specific identity (which is the value of the <code>config</code> <code>name</code> attribute or the <code>model</code> and the <code>name</code> combination).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the provisioning mechanism analysing the installation being provisioned discovers multiple configuration models with the same identity, <strong>it does not throw an error but merges the configuration models into one</strong> (which may still result in an error, of course).
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_anonymous_configs">4.5.1. Anonymous configs</h4>
<div class="paragraph">
<p>Anonymous configs are associated with neither name nor model. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0"&gt;
  &lt;config&gt;
    &lt;!-- config body --&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>That means anonymous configs have no identity. They cannot be customized and they are not merged. Each anonymous config is a standalone config.</p>
</div>
</div>
<div class="sect3">
<h4 id="_named_name_only_configs">4.5.2. Named (name-only) configs</h4>
<div class="paragraph">
<p>The simplest way to provide an identity for the configuration is to give it a name. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
  &lt;config name="config1"&gt;
    &lt;feature spec="feature1"&gt;
      &lt;param name="id" value="1"/&gt;
      &lt;param name="a" value="fp1"/&gt;
      &lt;param name="b" value="fp1"/&gt;
    &lt;/feature&gt;
    &lt;feature spec="feature2"&gt;
      &lt;param name="id" value="1"/&gt;
    &lt;/feature&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if another feature-pack provides a config with the same name, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp2" version="1.0.0.Final"&gt;
  &lt;config name="config1"&gt;
    &lt;feature spec="feature1"&gt;
      &lt;param name="id" value="1"/&gt;
      &lt;param name="b" value="fp2"/&gt;
    &lt;/feature&gt;
    &lt;feature spec="feature3"&gt;
      &lt;param name="id" value="1"/&gt;
    &lt;/feature&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we include both of these feature packs into the same installation</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:wildfly:pm-provisioning:1.0"&gt;
  &lt;feature-pack groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0.Final"/&gt;
  &lt;feature-pack groupId="org.jboss.pm.test" artifactId="fp2" version="1.0.0.Final"/&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The provisioned <strong>config1</strong> will be the result of merging the <strong>config1</strong> from the <strong>fp2</strong> into the <strong>config1</strong> of from the <strong>fp1</strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Which config overwrites which depends on the order in which the feature-packs are listed in the <code>provisioning.xml</code> file (under the <code>installation</code> element).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is the content of the provisioned <strong>config1</strong>:</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp1:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp1:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp2:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp2:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The features of the <strong>feature1</strong> spec are not merged although they appear to have the same ID. The reason is that the <strong>fp2</strong> does not declare the dependency on the <strong>fp1</strong> and its feature specs are not available in the <strong>fp2</strong> configs. So this example assumes that both <strong>fp1</strong> and <strong>fp2</strong> include the feature spec <strong>feature1</strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is how the <strong>fp2</strong> feature-pack.xml had to be written so that the <strong>feature1</strong> spec could be re-used in the <strong>fp2</strong> config.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp2" version="1.0.0.Final"&gt;
  &lt;dependencies&gt;
    &lt;dependency groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
      &lt;name&gt;fp1-dep&lt;/name&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;config name="config1"&gt;
    &lt;feature-pack dependency="fp1-dep"&gt;
      &lt;feature spec="feature1"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="b" value="fp2"/&gt;
      &lt;/feature&gt;
    &lt;/feature-pack&gt;
    &lt;feature spec="feature3"&gt;
      &lt;param name="id" value="1"/&gt;
    &lt;/feature&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this feature-pack configuration the resulting <strong>config1</strong> will include the following features:</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp1:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp1:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp2:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_named_model_configs">4.5.3. Named model configs</h4>
<div class="paragraph">
<p>There are a couple of reasons for adding the <code>model</code> attribute into the config identity. One of them is to define the scope for the <code>name</code> attribute. In this sense, the <code>model</code> could be thought of as a namespace. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
  &lt;config name="main" model="modelA"&gt;
    &lt;feature spec="feature1"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="a" value="fp1-modelA"/&gt;
        &lt;param name="b" value="fp1-modelA"/&gt;
    &lt;/feature&gt;
  &lt;/config&gt;
  &lt;config name="main" model="modelB"&gt;
    &lt;feature spec="feature1"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="a" value="fp1-modelB"/&gt;
        &lt;param name="b" value="fp1-modelB"/&gt;
    &lt;/feature&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp2" version="1.0.0.Final"&gt;
  &lt;dependencies&gt;
    &lt;dependency groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
      &lt;name&gt;fp1-dep&lt;/name&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;config name="main" model="modelA"&gt;
    &lt;feature-pack dependency="fp1-dep"&gt;
        &lt;feature spec="feature1"&gt;
            &lt;param name="id" value="1"/&gt;
            &lt;param name="b" value="fp2-modelA"/&gt;
        &lt;/feature&gt;
    &lt;feature-pack&gt;
  &lt;/config&gt;
  &lt;config name="main" model="modelB"&gt;
    &lt;feature-pack dependency="fp1-dep"&gt;
      &lt;feature spec="feature1"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="b" value="fp2-modelB"/&gt;
      &lt;/feature&gt;
    &lt;feature-pack&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Installing these two feature-packs (<strong>fp2</strong> after the <strong>fp1</strong>) will result in the following two configurations:</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Config model</th>
<th class="tableblock halign-left valign-top">Config name</th>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">main</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp1:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelA</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Config model</th>
<th class="tableblock halign-left valign-top">Config name</th>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">main</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp1:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelB</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_model_only_configs">4.5.4. Model-only configs</h4>
<div class="paragraph">
<p>Model-only configs are the configs that are associated with a specific model using the <code>model</code> attribute of the <code>config</code> element but are not associated with any name.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Model-only configs are meant to be merged into other configs. The provisioned installation will contain only anonymous or named configs but not the model-only ones.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Model only configs are merged into <strong>all</strong> the named configs of the installation that are associated with the same model as the model-only config.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A model-only config will simply be ignored if the installation does not include any named config with the same model as the model-only config.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The idea behind the model-only configs is to be able to define the base for a config of a specific model that every final configuration of that model should include. Model-only configs are always added into the configuration before the named model configs, i.e. the named configs will be added on top of the model-only ones and will overwrite them.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
  &lt;config model="modelA"&gt;
    &lt;feature spec="feature1"&gt;
      &lt;param name="id" value="1"/&gt;
      &lt;param name="a" value="fp1-modelA"/&gt;
      &lt;param name="b" value="fp1-modelA"/&gt;
    &lt;/feature&gt;
  &lt;/config&gt;
  &lt;config name="main" model="modelB"&gt;
    &lt;feature spec="feature1"&gt;
      &lt;param name="id" value="1"/&gt;
      &lt;param name="b" value="fp1-modelB"/&gt;
    &lt;/feature&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp2" version="1.0.0.Final"&gt;
  &lt;dependencies&gt;
    &lt;dependency groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
      &lt;name&gt;fp1-dep&lt;/name&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;config name="main" model="modelA"&gt;
    &lt;feature-pack dependency="fp1-dep"&gt;
      &lt;feature spec="feature1"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="b" value="fp2-modelA"/&gt;
      &lt;/feature&gt;
    &lt;feature-pack&gt;
  &lt;/config&gt;
  &lt;config name="test" model="modelA"&gt;
    &lt;feature spec="feature2"&gt;
      &lt;param name="id" value="1"/&gt;
      &lt;param name="a" value="fp2-modelA"/&gt;
      &lt;param name="b" value="fp2-modelA"/&gt;
    &lt;/feature&gt;
  &lt;/config&gt;
  &lt;config model="modelB"&gt;
    &lt;feature-pack dependency="fp1-dep"&gt;
      &lt;feature spec="feature1"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="a" value="fp2-modelB"/&gt;
        &lt;param name="b" value="fp2-modelB"/&gt;
      &lt;/feature&gt;
    &lt;feature-pack&gt;
  &lt;/config&gt;
  &lt;config name="test" model="modelB"&gt;
    &lt;feature spec="feature2"&gt;
      &lt;param name="id" value="1"/&gt;
      &lt;param name="a" value="fp2-modelB"/&gt;
      &lt;param name="b" value="fp2-modelB"/&gt;
    &lt;/feature&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Installing these two feature-packs will result in the following configurations:</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Config model</th>
<th class="tableblock halign-left valign-top">Config name</th>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">main</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp1:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelA</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Config model</th>
<th class="tableblock halign-left valign-top">Config name</th>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp1:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelA</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp2:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelA</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Config model</th>
<th class="tableblock halign-left valign-top">Config name</th>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">main</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp1:1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelB</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Config model</th>
<th class="tableblock halign-left valign-top">Config name</th>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp1:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp2:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelB</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_excluding_model_only_configs_with_the_exclude_element">Excluding model-only configs with the exclude element</h5>
<div class="paragraph">
<p>Normally, model-only configs are not supposed to be explicitly excluded. If a user excludes all the named configs of a specific model, the model-only configs of that model will implicitly be ignored by the provisioning mechanism.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Config model designers are encouraged to design the configs in a way that model-only configs represent essential configuration and don&#8217;t need to be excluded explicitly by the users or should be excluded in exceptional cases.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In a previous chapter it was described how the default configs could be excluded from the provisioned installation by <a href="#excl-configs-by-model">specifying their model name</a>. Here is the example snipped again</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:wildfly:pm-provisioning:1.0"&gt;
    &lt;feature-pack groupId="org.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
        &lt;default-configs&gt;
            &lt;exclude model="model1"/&gt;
        &lt;/default-configs&gt;
    &lt;/feature-pack&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>exclude</code> element above <strong>does not</strong> affect the model-only configs. It affects <strong>only</strong> the named configs. And in this specific example this fact will not make any difference on the result which is why, as a user, you shouldn&#8217;t care about it, since if the named configs are excluded, the model-only configs will automatically be ignored by the provisioning mechanism. Let&#8217;s look at an example where it makes a real difference.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
  &lt;config model="modelA"&gt;
    &lt;feature spec="feature1"&gt;
      &lt;param name="id" value="1"/&gt;
      &lt;param name="a" value="fp1-modelA"/&gt;
      &lt;param name="b" value="fp1-modelA"/&gt;
      &lt;param name="c" value="fp1-modelA"/&gt;
    &lt;/feature&gt;
  &lt;/config&gt;
  &lt;config name="main" model="modelA"&gt;
    &lt;feature spec="feature1"&gt;
      &lt;param name="id" value="1"/&gt;
      &lt;param name="b" value="fp1-modelB-main"/&gt;
    &lt;/feature&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp2" version="1.0.0.Final"&gt;
  &lt;dependencies&gt;
    &lt;dependency groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
      &lt;name&gt;fp1-dep&lt;/name&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;config name="main" model="modelA"&gt;
    &lt;feature-pack dependency="fp1-dep"&gt;
      &lt;feature spec="feature1"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="c" value="fp2-modelA-main"/&gt;
      &lt;/feature&gt;
    &lt;feature-pack&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we install these feature-packs the resulting config will contain</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
<th class="tableblock halign-left valign-top">c</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp1:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelA-main</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelA-main</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If, we exclude the <strong>modelA</strong> like it was shown in the previous example <strong>in the declaration of the dependency on the fp1</strong>, i.e.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp2" version="1.0.0.Final"&gt;
  &lt;dependencies&gt;
    &lt;dependency groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
      &lt;name&gt;fp1-dep&lt;/name&gt;
      &lt;default-configs&gt;
        &lt;exclude model="modelA"/&gt;
      &lt;/default-configs&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;config name="main" model="modelA"&gt;
    &lt;feature-pack dependency="fp1-dep"&gt;
      &lt;feature spec="feature1"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="c" value="fp2-modelA-main"/&gt;
      &lt;/feature&gt;
    &lt;feature-pack&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we install the <strong>fp2</strong>, the provisioned configuration will contain</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
<th class="tableblock halign-left valign-top">c</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp1:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp1-modelA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelA-main</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The model-only config from <strong>fp1</strong> is still effective because it is considered as an essential for any named config of the <strong>modelA</strong>. In case it still has to be excluded from the provisioned config you can add the <code>named-only-models="false"</code> attribute to the <code>exclude</code> element, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp2" version="1.0.0.Final"&gt;
  &lt;dependencies&gt;
    &lt;dependency groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
      &lt;name&gt;fp1-dep&lt;/name&gt;
      &lt;default-configs&gt;
        &lt;exclude model="modelA" named-only-models="false"/&gt;
      &lt;/default-configs&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;config name="main" model="modelA"&gt;
    &lt;feature-pack dependency="fp1-dep"&gt;
      &lt;feature spec="feature1"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="c" value="fp2-modelA-main"/&gt;
      &lt;/feature&gt;
    &lt;feature-pack&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>exclude</code> element above affects both named and model-only configs of <strong>modelA</strong> from the feature-pack <strong>fp1</strong>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>named-only-models</code> attribute is optional and if abscent its value is assumed to be <strong>true</strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The provisioned configuration of the <strong>fp2</strong> will now contain</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">c</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp1:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelA-main</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_disabling_inheritance_of_the_model_only_configs">Disabling inheritance of the model-only configs</h5>
<div class="paragraph">
<p>In an earlier chapter it was shown <a href="#disable-def-configs">how the default configs of a feature-pack could be suppressed</a>. Let&#8217;s now include the model-only config in the example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
  &lt;config model="modelA"&gt;
    &lt;feature spec="feature1"&gt;
      &lt;param name="id" value="1"/&gt;
      &lt;param name="a" value="fp1-modelA"/&gt;
      &lt;param name="b" value="fp1-modelA"/&gt;
      &lt;param name="c" value="fp1-modelA"/&gt;
    &lt;/feature&gt;
  &lt;/config&gt;
  &lt;config name="main" model="modelA"&gt;
    &lt;feature spec="feature1"&gt;
      &lt;param name="id" value="1"/&gt;
      &lt;param name="b" value="fp1-modelB-main"/&gt;
    &lt;/feature&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp2" version="1.0.0.Final"&gt;
  &lt;dependencies&gt;
    &lt;dependency groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
      &lt;name&gt;fp1-dep&lt;/name&gt;
      &lt;default-configs inherit="false"/&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;config name="main" model="modelA"&gt;
    &lt;feature-pack dependency="fp1-dep"&gt;
      &lt;feature spec="feature1"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="c" value="fp2-modelA-main"/&gt;
      &lt;/feature&gt;
    &lt;feature-pack&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the <code>inherit="false"</code> attribute of the <code>default-configs</code> element we indicated that the default configs of <strong>fp1</strong> should not be included into the provisioned installation of <strong>fp2</strong>. But it does not affect the model-only configs. So the model-only <strong>modelA</strong> config will still be effective in <strong>fp2</strong>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>inherit-unnamed-models</code> attributes of the <code>default-configs</code> element controls whether the model-only configs are inherited or not. The attribute is optional and if not present, its value is assumed to be <strong>true</strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is an example that disables the inheritance of all the anonymous, named and model-only configs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp2" version="1.0.0.Final"&gt;
  &lt;dependencies&gt;
    &lt;dependency groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
      &lt;name&gt;fp1-dep&lt;/name&gt;
      &lt;default-configs inherit="false" inherit-unnamed-models="false"/&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;config name="main" model="modelA"&gt;
    &lt;feature-pack dependency="fp1-dep"&gt;
      &lt;feature spec="feature1"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="c" value="fp2-modelA-main"/&gt;
      &lt;/feature&gt;
    &lt;feature-pack&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The provisioned configuration of <strong>fp2</strong> will now contain</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature spec origin</th>
<th class="tableblock halign-left valign-top">Feature spec</th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">c</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.pm.test:fp1:1.0.0.Final</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feature1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fp2-modelA-main</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_content_of_the_config_element">4.6. Content of the config element</h3>
<div class="paragraph">
<p>The <code>config</code> element is basically an extended version of the <a href="#_feature_groups"><code>feature-group</code> element</a>. Meaning that everything that is allowed in the body of the <code>feature-group</code> is allowed in the <code>config</code> element. Which means the <code>feature</code> and the <code>feature-group</code> elements (as well as the <code>feature-pack</code> element for dependencies).</p>
</div>
<div class="paragraph">
<p>Besides that the config element supports already mentioned in an earlier chapter the <a href="#_configuration_model_attributes">config attributes</a> and the <code>props</code> element.</p>
</div>
<div class="paragraph">
<p>The <code>props</code> element allows to attach various properties to the configuration described by the <code>config</code> element that can be meaningful for the provisioning plugin processing the configuration. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
  &lt;config name="main" model="modelA"&gt;
    &lt;props&gt;
      &lt;prop name="save-to-file" value="model-a.xml"/&gt;
      &lt;prop name="other" value="thing"/&gt;
    &lt;/props&gt;
    &lt;feature spec="feature1"&gt;
      &lt;param name="id" value="1"/&gt;
      &lt;param name="a" value="fp1-modelA"/&gt;
    &lt;/feature&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The config properties are not used by the generic provisioning mechanism itself (only the relevant plugins).
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_overwriting_properties_during_config_inclusion">4.6.1. Overwriting properties during config inclusion</h4>
<div class="paragraph">
<p>When a default config is included, its properties can be overwritten, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;installation xmlns="urn:wildfly:pm-provisioning:1.0"&gt;
    &lt;feature-pack groupId="org.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
        &lt;default-configs&gt;
            &lt;include name="main" model="modelA"&gt;
              &lt;props&gt;
                &lt;prop name="save-to-file" value="main-model-a.xml"/&gt;
              &lt;/props&gt;
            &lt;/include&gt;
        &lt;/default-configs&gt;
    &lt;/feature-pack&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resolved config will include the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>save-to-file=main-model-a.xml;</p>
</li>
<li>
<p>other=thing.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_overwriting_properties_when_merging_configs">4.6.2. Overwriting properties when merging configs</h4>
<div class="paragraph">
<p>When the <a href="#_configuration_model_merges">configs are merged</a>, their properties are also merged. The config that is included later into the installation overwrites the properties of the config which was added before. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
  &lt;config model="modelA"&gt;
    &lt;props&gt;
      &lt;prop name="save-to-file" value="model-a.xml"/&gt;
      &lt;prop name="other" value="thing"/&gt;
    &lt;/props&gt;
    &lt;feature spec="feature1"&gt;
      &lt;param name="id" value="1"/&gt;
      &lt;param name="a" value="fp1-modelA"/&gt;
    &lt;/feature&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp2" version="1.0.0.Final"&gt;
  &lt;dependencies&gt;
    &lt;dependency groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
      &lt;name&gt;fp1-dep&lt;/name&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;config name="main" model="modelA"&gt;
    &lt;props&gt;
      &lt;prop name="save-to-file" value="main-model-a.xml"/&gt;
    &lt;/props&gt;
    &lt;feature-pack dependency="fp1-dep"&gt;
      &lt;feature spec="feature1"&gt;
        &lt;param name="id" value="1"/&gt;
        &lt;param name="a" value="fp2-modelA"/&gt;
      &lt;/feature&gt;
    &lt;feature-pack&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resolve configuration <strong>modelA:main</strong> will contain the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>save-to-file=main-model-a.xml;</p>
</li>
<li>
<p>other=thing.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_config_package_dependencies">4.7. Config package dependencies</h3>
<div class="paragraph">
<p><code>config</code> elements may include the feature-pack package dependencies. So that when the config is included into the installation, the relevant packages are automatically included as well. The package dependencies are configured using the same elements used for <a href="#_feature_package_dependencies">the feature package dependencies</a>. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
              groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0.Final"&gt;
  &lt;config model="modelA"&gt;
    &lt;packages&gt;
     &lt;package name="p1"/&gt;
     &lt;package name="p2" optional="true"/&gt;
    &lt;/packages&gt;
  &lt;/config&gt;
&lt;/feature-pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now every config of the <strong>modelA</strong> will depend on and implicitly will bring into the installation the specified packages.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wildfly_provisioning">5. WildFly provisioning</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The WildFly provisioning docs are very much out of date. They pretty much can be ignored. The updates are coming soon.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_wildfly_pm_provisioning_plug_in">5.1. WildFly PM Provisioning Plug-in</h3>
<div class="paragraph">
<p>This chapter describes the WildFly provisioning plug-in which is included into feature-packs of WildFly-based distributions.</p>
</div>
<div class="paragraph">
<p>The plug-in is called by the PM tool after the feature-pack and package dependencies have been resolved and the content from packages has been copied to the target installation directory.</p>
</div>
<div class="paragraph">
<p>The WildFly provisioning plug-in is then responsible for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#config-gen">generating the configuration file(s) based on the installed package set (possibly customized by the user)</a>;</p>
</li>
<li>
<p><a href="#module-jars">building "thin" servers (i.e. servers with module.xml files referencing module JARs as Maven artifacts) or copying module JARs into the target installation</a>;</p>
</li>
<li>
<p><a href="#wildfly-tasks-xml">performing other tasks configured in wildlfy-tasks.xml</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="config-gen">5.1.1. Configuration generation</h4>
<div class="paragraph">
<p>The configuration of the target installation is generated by executing WildFly CLI scripts collected from the packages making up the installation.</p>
</div>
<div class="paragraph">
<p>Based on the feature-pack and package dependencies, the PM tool determines the order in which the packages making up the installation should be installed. The WildFly provisioning plug-in then iterates through the packages in that order collecting CLI scripts that represent package-specific configuration snippets.</p>
</div>
<div class="paragraph">
<p>Once all the CLI scripts have been collected, the plug-in launches a CLI session, embeds the server with an empty configuration and runs the collected scripts.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note: <strong>the scripts are not executed in a batch</strong> (i.e. as a composite operation). In case some operations have to be combined into a batch, it is the responsibility of the package developer to start and run the batch from the script attached to the package.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In case any of the CLI command and/or operation fails, the whole provisioning process will be aborted by the PM tool.</p>
</div>
</div>
<div class="sect3">
<h4 id="module-jars">5.1.2. Thin servers vs local module JARs</h4>
<div class="paragraph">
<p>By default, the plug-in will resolve Maven module artifacts and copy the JARs to the target installation.</p>
</div>
<div class="paragraph">
<p>However, the plug-in checks system property <strong>wfThinServer</strong> and if it is present and its value is empty or true, the resulting installation will not include the module JARs but will reference the corresponding Maven artifacts instead from the modules' <strong>module.xml</strong> files.</p>
</div>
<div class="paragraph">
<p>The system property has to be set either on the command line launching the PM tool, e.g.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">pm -DwfThinServer &lt;other arguments&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>or from a Java client using the PM public API.</p>
</div>
</div>
<div class="sect3">
<h4 id="wildfly-tasks-xml">5.1.3. wildfly-tasks.xml</h4>
<div class="paragraph">
<p>WildFly feature-packs may include <strong>wildfly-tasks.xml</strong> file into their <strong>resources/wildfly</strong> directory. The currently supported tasks include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>set filesystem permissions on the specified paths;</p>
</li>
<li>
<p>create empty directories;</p>
</li>
<li>
<p>correct line endings for the target operating system for the specified files.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an example of <strong>wildfly-tasks.xml</strong>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;tasks xmlns="urn:wildfly:wildfly-feature-pack-tasks:2.0"&gt;
   &lt;mkdirs&gt;
       &lt;dir name="domain/data/content"/&gt;
       &lt;dir name="standalone/lib/ext"/&gt;
       &lt;dir name="domain/tmp/auth"/&gt;
       &lt;dir name="standalone/tmp/auth"/&gt;
       &lt;dir name=".installation"/&gt;
   &lt;/mkdirs&gt;
   &lt;file-permissions&gt;
       &lt;permission value="755"&gt;
           &lt;filter pattern="*.sh" include="true"/&gt;
           &lt;filter pattern="*" include="false"/&gt;
       &lt;/permission&gt;
       &lt;permission value="700"&gt;
           &lt;filter pattern="*/tmp/auth" include="true"/&gt;
           &lt;filter pattern="*" include="false"/&gt;
       &lt;/permission&gt;
       &lt;permission value="600"&gt;
           &lt;filter pattern="*-users.properties" include="true"/&gt;
           &lt;filter pattern="*/.installation" include="true"/&gt;
           &lt;filter pattern="*" include="false"/&gt;
       &lt;/permission&gt;
   &lt;/file-permissions&gt;
&lt;/tasks&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wildfly_feature_pack_building_maven_plug_in">5.2. WildFly Feature-pack Building Maven Plug-in</h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="_demo">5.3. Demo</h3>
<div class="paragraph">
<p>This chapter describes how to try the tool provisioning WildFly Core, Servlet and Full distributions and their customized versions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please, just keep in mind, there hasn&#8217;t been even an Alpha release, it&#8217;s not perfect. This chapter is here for people interested in following the evolution of the tool and communicating their requirements. Please direct your questions or feedback to <a href="mailto:olubyans@redhat.com">the developer</a>. Thanks!
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_the_tool">5.3.1. The tool</h4>
<div class="paragraph">
<p>The tool can be downloaded from <a href="https://github.com/aloubyansky/pm/tree/demo">here</a> and then built using</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">mvn clean install</pre>
</div>
</div>
<div class="paragraph">
<p>There is also <code>./do.sh</code> script for convenience in the root directory of the project which, if launched w/o arguments, will build the project and launch the tool&#8217;s command-line interface.
The command-line interface can also be launched w/o re-building the project by</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">./do.sh run</pre>
</div>
</div>
<div class="paragraph">
<p>The CLI session can be terminated by executing command <code>exit</code> or simply pressing <code>Ctrl-C</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_wildfly_core">5.3.2. WildFly Core</h4>
<div class="paragraph">
<p>The branch of WildFly Core that uses the Maven plug-in from the provisioning tool to build the new feature-packs (along with the currently actually in-use ones) and install them into the local Maven repo is <a href="https://github.com/aloubyansky/wildfly-core/tree/new-feature-pack-demo">here</a>.</p>
</div>
<div class="paragraph">
<p>Check it out and build WildFly Core using</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">mvn clean install -DskipTests</pre>
</div>
</div>
<div class="paragraph">
<p>to install the new provisioning feature-packs into your local Maven repository.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
skipping the tests is suggested only to save your time, there aren&#8217;t any expected failures.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_wildfly_servlet_and_full">5.3.3. WildFly Servlet and Full</h4>
<div class="paragraph">
<p>Servlet and Full feature-packs are produced by the same build process in <a href="https://github.com/aloubyansky/wildfly/tree/new-feature-pack-demo">this branch</a>.</p>
</div>
<div class="paragraph">
<p>Check it out and build the project using</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">mvn clean install -DskipTests</pre>
</div>
</div>
<div class="paragraph">
<p>to install WildFly Servlet and Full feature-packs into your local Maven repository.</p>
</div>
</div>
<div class="sect3">
<h4 id="_installing_core_servlet_and_full_distributions">5.3.4. Installing Core, Servlet and Full distributions</h4>
<div class="paragraph">
<p>Once you&#8217;ve downloaded and built the tool and then the <code>wfcore</code> and <code>wildfly</code> projects, have the feature-packs installed into your local repositories, you can try using the tool to actually install the projects at a specific location.</p>
</div>
<div class="paragraph">
<p>Here is how you can install the core:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">./do.sh run
[pm]$ install org.wildfly.core:wildfly-core-feature-pack-new:3.0.0.Beta29-SNAPSHOT --dir=&lt;installation-home&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Tab-completion should work for the feature-pack coords.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Prompt <code>[pm]$</code> indicates that the current file-system directory is <code>pm</code>.</p>
</div>
<div class="paragraph">
<p><code>--dir</code> argument is optional, if it is not present, the current file-system directory will be used as the installation home directory.</p>
</div>
<div class="paragraph">
<p>Servlet and Full distributions can be installed with the same command but using the corresponding feature-pack coordinates, i.e.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.wildfly:wildfly-servlet-feature-pack-new:11.0.0.Beta1-SNAPSHOT</code> for the Servlet distribution;</p>
</li>
<li>
<p><code>org.wildfly:wildfly-feature-pack-new:11.0.0.Beta1-SNAPSHOT</code> for the Full distribution.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since Full feature-pack depends on Servlet feature-pack and Servlet feature-pack depends on Core feature-pack, installing Full feature-pack will implicitly install Servlet and Core feature-packs.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_uninstalling_a_feature_pack">5.3.5. Uninstalling a feature-pack</h4>
<div class="paragraph">
<p>Using the Core as an example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">[pm]$ uninstall org.wildfly.core:wildfly-core-feature-pack-new:3.0.0.Beta29-SNAPSHOT --dir=&lt;installation-home&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_exporting_current_provisioning_specification">5.3.6. Exporting Current Provisioning Specification</h4>
<div class="literalblock">
<div class="content">
<pre class="nowrap">[pm]$ cd &lt;installation-home&gt;
[&lt;installation-home&gt;]$ provisioned-spec export &lt;work-dir&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><code>&lt;work-dir&gt;</code> will contain <code>provisioning.xml</code> which is the current provisioning specification of the installation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_provisioning_specific_default_configuration">5.3.7. Provisioning specific default configuration</h4>
<div class="paragraph">
<p>Installing any of the feature-packs will produce an installation that is equivalent to our default build or release, meaning it will contain all the modules, standalone and domain configurations.</p>
</div>
<div class="paragraph">
<p>Each feature-pack has a package called <code>dist.standalone</code>. If this package is selected, it will pull the modules and configuration necessary to run the standalone server. Here is how a user can install only the standalone server:</p>
</div>
<div class="paragraph">
<p>1) Export the <code>provisioning.xml</code> from the default installation to use as a config template.</p>
</div>
<div class="paragraph">
<p>2) Modfiy the feature-pack config (let&#8217;s use Core as an example) to</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack groupId="org.wildfly.core" artifactId="wildfly-core-feature-pack-new" version="3.0.0.Beta29-SNAPSHOT"&gt;
    &lt;packages inherit="false"&gt;
        &lt;include name="dist.standalone"/&gt;
    &lt;/packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>3) From the provisioning CLI execute</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">provision-spec &lt;work-dir&gt;/provisioning.xml --dir=&lt;installation-home&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>What you&#8217;ve done is excluded all the packages installed by default from the specified feature-pack and included only <code>dist.standalone</code> and its dependencies that are installed implicitly.
You can do the same exercise for <code>dist.domain</code> package.</p>
</div>
<div class="paragraph">
<p>Complete list of the default (pre-defined) distributions that can be installed in this way for Core feature-pack is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dist.standalone</p>
</li>
<li>
<p>dist.domain</p>
</li>
<li>
<p>dist.legacy (combines the packages above)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>for Servlet feature-pack:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dist.standalone</p>
</li>
<li>
<p>dist.load-balancer</p>
</li>
<li>
<p>dist.domain</p>
</li>
<li>
<p>dist.legacy (combines the packages above)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>for Full feature-pack:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dist.domain</p>
</li>
<li>
<p>dist.domain-full</p>
</li>
<li>
<p>dist.domain-full-ha</p>
</li>
<li>
<p>dist.domain-ha</p>
</li>
<li>
<p>dist.domain-load-balancer</p>
</li>
<li>
<p>dist.standalone</p>
</li>
<li>
<p>dist.standalone-full</p>
</li>
<li>
<p>dist.standalone-full-ha</p>
</li>
<li>
<p>dist.standalone-ha</p>
</li>
<li>
<p>dist.legacy (combines the packages above)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can try customizing the installation further by including and/or excluding specific packages that represent modules and subsystems in the same way.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0.0.Alpha-SNAPSHOT<br>
Last updated 2017-11-10 11:30:55 CET
</div>
</div>
</body>
</html>