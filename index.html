<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<meta name="author" content="Alexey Loubyansky">
<title>PM Provisioning Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>PM Provisioning Documentation</h1>
<div class="details">
<span id="author" class="author">Alexey Loubyansky</span><br>
<span id="revnumber">version 1.0.0.Alpha-SNAPSHOT,</span>
<span id="revdate">2017-07-18</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">1. Overview</a></li>
<li><a href="#_feature_packs">2. Feature-packs</a>
<ul class="sectlevel2">
<li><a href="#_feature_pack_archive_structure">2.1. Feature-pack archive structure</a></li>
<li><a href="#_feature_pack_metadata_feature_pack_xml">2.2. Feature-pack metadata (feature-pack.xml)</a></li>
</ul>
</li>
<li><a href="#_feature_pack_packages">3. Feature-pack packages</a>
<ul class="sectlevel2">
<li><a href="#_package_directory_structure">3.1. Package directory structure</a></li>
<li><a href="#_package_metadata_package_xml">3.2. Package metadata (package.xml)</a></li>
<li><a href="#_package_dependencies">3.3. Package dependencies</a></li>
</ul>
</li>
<li><a href="#_provisioned_package_set">4. Provisioned package set</a>
<ul class="sectlevel2">
<li><a href="#_feature_pack_without_dependencies">4.1. Feature-pack without dependencies</a></li>
<li><a href="#_feature_pack_with_dependencies">4.2. Feature-pack with dependencies</a></li>
</ul>
</li>
<li><a href="#_wildfly_provisioning">5. WildFly provisioning</a>
<ul class="sectlevel2">
<li><a href="#_wildfly_pm_provisioning_plug_in">5.1. WildFly PM Provisioning Plug-in</a></li>
<li><a href="#_wildfly_feature_pack_building_maven_plug_in">5.2. WildFly Feature-pack Building Maven Plug-in</a></li>
<li><a href="#_demo">5.3. Demo</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>&#169; 2017 The original authors.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">1. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>PM is a Java provisioning tool designed to address provisioning and patching requirements of Java projects.</p>
</div>
<div class="paragraph">
<p>Provisioning and patching tasks can be performed using either the tool&#8217;s command-line interface or its public API from a user application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_feature_packs">2. Feature-packs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Feature-pack represents a released unit of software that can be installed or uninstalled using the provisioning tool. Feature-packs are Maven artifacts identified by GAV (groupId, artifactId and version).</p>
</div>
<div class="paragraph">
<p>Feature-pack contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>metadata describing the feature-pack;</p>
</li>
<li>
<p>a set of packages;</p>
</li>
<li>
<p><em>(optional)</em> various resources required to properly assemble and setup the installation;</p>
</li>
<li>
<p><em>(optional)</em> custom provisioning plug-ins.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Feature-pack may declare dependencies on other feature-packs. Before a feature-pack is installed the tool will make sure its dependencies are satisifed (installing the missing ones).</p>
</div>
<div class="paragraph">
<p>Conceptutally, any software installation can be described as one or more feature-packs installed at a specific location.</p>
</div>
<div class="sect2">
<h3 id="_feature_pack_archive_structure">2.1. Feature-pack archive structure</h3>
<div class="paragraph">
<p>Feature-packs are distributed as ZIP archives with the following root entries:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">feature-pack.zip
|- packages/
|- resources/
|- plugins/
`- feature-pack.xml</pre>
</div>
</div>
<div class="paragraph">
<p>Where</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>packages</strong> - directory containing feature-pack packages;</p>
</li>
<li>
<p><strong>resources</strong> - optional directory containing various resources needed to properly setup the installation;</p>
</li>
<li>
<p><strong>plugins</strong> - optional directory containing project/product-specific provisioning plug-ins;</p>
</li>
<li>
<p><strong>feature-pack.xml</strong> - metadata describing the feature-pack.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_feature_pack_metadata_feature_pack_xml">2.2. Feature-pack metadata (feature-pack.xml)</h3>
<div class="paragraph">
<p>Feature-pack metadata contains the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>GAV</strong> - feature-pack groupId, artifactId and version;</p>
</li>
<li>
<p><strong>default packages</strong> - the names of the packages that are installed by default;</p>
</li>
<li>
<p><em>(optional)</em> <strong>dependencies</strong> -  dependencies on other feature-packs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an illustration of how it may look like in a <strong>feature-pack.xml</strong> file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
               groupId="org.my-group"
               artifactId="my-artifact"
               version="1.0.0.Alpha1"&gt;
   &lt;dependencies&gt;
       &lt;dependency groupId="org.another-group"
                   artifactId="another-artifact"
                   version="3.0.0.Final"/&gt;
   &lt;/dependencies&gt;
   &lt;default-packages&gt;
       &lt;package name="package1"/&gt;
       &lt;package name="package2"/&gt;
   &lt;/default-packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Here feature-pack <strong>org.my-group:my-artifact:1.0.0.Alpha1</strong> depends on feature-pack <strong>org.another-group:another-artifact:3.0.0.Final</strong> and has packages <strong>package1</strong> and <strong>package2</strong> that are installed by default.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_feature_pack_packages">3. Feature-pack packages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Package is a minimal atomic unit of a feature-pack that can be included into or excluded from the installation. It could be a set of files and/or provisioning resources used by the provisioning tool to install the package.</p>
</div>
<div class="paragraph">
<p>Essentially, a software release is a set of packages released under a common version.</p>
</div>
<div class="paragraph">
<p>Package contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>metadata describing the package;</p>
</li>
<li>
<p><em>(optional)</em> content which is added to the installation when the package is installed;</p>
</li>
<li>
<p><em>(optional)</em> other resources that are used during provisioning to integrate the content (or what the package represents) properly into the target installation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Package may declare dependencies on other packages that belong to the same or another feature-pack. Before a package is installed, the tool will make sure all its dependencies are satisifed (installing the missing ones).</p>
</div>
<div class="paragraph">
<p>Package is identified by its name. The name must be unique in the feature-pack the package belongs to.</p>
</div>
<div class="paragraph">
<p>Packages are not versioned. Only the feature-pack has a version.</p>
</div>
<div class="sect2">
<h3 id="_package_directory_structure">3.1. Package directory structure</h3>
<div class="paragraph">
<p>Packages are stored in the directories (named after the packages) under the feature-pack <strong>packages</strong> directory.</p>
</div>
<div class="paragraph">
<p>Package directory contains the following entries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>package.xml</strong> - the metadata describing the package;</p>
</li>
<li>
<p><em>(optional)</em> <strong>content</strong> - directory containing the content of the package which will be added to the installation when the package is installed;</p>
</li>
<li>
<p><em>(optional)</em> <strong>pm</strong> - directory containing various resources needed to properly install/integrate the content of the package.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an illustration of the <strong>packages</strong> entry from a feature-pack archive containing packages p1, p2, p3 and p4:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">packages/
|-p1/
| |-content/
| | `-...
| |-pm/
| | `-...
| `-package.xml
|-p2/
| |-content/
| | `-...
| `-package.xml
|-p3/
| |-pm/
| | `-...
| `-package.xml
`-p4/
  `-package.xml</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_package_metadata_package_xml">3.2. Package metadata (package.xml)</h3>
<div class="paragraph">
<p>Package metadata contains the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>package name</strong>;</p>
</li>
<li>
<p><em>(optional)</em> <strong>dependencies</strong> - dependencies on other packages from the same or other feature-packs;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an illustration of how a <strong>package.xml</strong> might look like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;package-spec xmlns="urn:wildfly:pm-package:1.0" name="p1"&gt;
   &lt;dependencies&gt;
       &lt;package name="p2"/&gt;
       &lt;package name="p3" optional="true"/&gt;
       &lt;feature-pack dependency="another-feature-pack"&gt;
           &lt;package name="p1"/&gt;
           &lt;package name="p11" optional="true"/&gt;
       &lt;/feature-pack&gt;
   &lt;/dependencies&gt;
&lt;/package-spec&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Here package <strong>p1</strong> declares dependencies on packages <strong>p2</strong> and <strong>p3</strong> that belong to the same feature-pack as <strong>p1</strong> and <strong>p1</strong> and <strong>p11</strong> that belong to another feature-pack referenced by alias <strong>another-feature-pack</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_package_dependencies">3.3. Package dependencies</h3>
<div class="paragraph">
<p>Package dependency may be required or optional.</p>
</div>
<div class="paragraph">
<p><strong>Required dependency</strong> means that a package cannot be installed unless all its required dependencies are satisfied, i.e. installed. If any required dependency cannot be satisfied (perhaps because a package that happens to be a required dependency of another package was explicitly excluded), the provisioning process will fail with an error.</p>
</div>
<div class="paragraph">
<p><strong>Optional dependency</strong> means that the dependency does not have to be satisfied for the package to be installed. For example if package <strong>p1</strong> declares an optional dependency on package <strong>p2</strong> and <strong>p2</strong> is explicitly excluded by the user, <strong>p1</strong> will still be installed. An example of an optional dependency could be a package called <strong>documentation</strong> which declares an optional dependency on package <strong>examples</strong>. If a user is not interested in the <strong>examples</strong>, the rest of the <strong>documentation</strong> could still be installed.</p>
</div>
<div class="paragraph">
<p>Package dependencies are also used to determine the <a href="#_feature_pack_without_dependencies">effective package set of a feature-pack</a> to be installed described later.</p>
</div>
<div class="sect3">
<h4 id="_local_package_dependencies">3.3.1. Local package dependencies</h4>
<div class="paragraph">
<p>If a package depends on another package from the same feature-pack, the dependency is called a local package dependency. Here is an example of how local dependencies are expressed in the XML metadata:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;package-spec xmlns="urn:wildfly:pm-package:1.0" name="p1"&gt;
   &lt;dependencies&gt;
       &lt;package name="p2"/&gt;
       &lt;package name="p3" optional=”true”/&gt;
   &lt;/dependencies&gt;
&lt;/package-spec&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In this example <strong>p2</strong> is a required dependency of <strong>p1</strong> while <strong>p3</strong> is an optional one.</p>
</div>
</div>
<div class="sect3">
<h4 id="_external_package_dependencies">3.3.2. External package dependencies</h4>
<div class="paragraph">
<p>If a package depends on a package from another feature-pack, the dependency is called an external package dependency.</p>
</div>
<div class="paragraph">
<p>Although a package may declare a dependency on a package from another feature-pack, it cannot specify the version of the feature-pack in the package dependency declaration.</p>
</div>
<div class="paragraph">
<p>Feature-pack containing a package with an external dependency must declare an explicit dependency on the feature-pack (specifying its version) the target package of the external dependency belongs to. This feature-pack dependency must also be assigned a name which will be used as a reference to the that dependency in the <strong>package.xml</strong> file where the external package dependency is declared.</p>
</div>
<div class="paragraph">
<p>For example, suppose feature-pack <strong>fp1</strong> depends on feature-pack <strong>fp2</strong> and package <strong>fp1:p1</strong> depends on packages <strong>fp2:p1</strong> and <strong>fp2:p10</strong>. The <strong>feature-pack.xml</strong> of <strong>fp1</strong> might look like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
               groupId="org.jboss.pm.test" artifactId="fp1" version="1.0.0"&gt;
   &lt;dependencies&gt;
       &lt;dependency groupId="org.jboss.pm.test" artifactId="fp2" version="2.0.0"&gt;
           &lt;name&gt;fp2-dep&lt;/name&gt;
       &lt;/dependency&gt;
   &lt;/dependencies&gt;
   &lt;default-packages&gt;
       &lt;package name="p1"/&gt;
   &lt;/default-packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>And the <strong>package.xml</strong> file of <strong>fp1:p1</strong> might look like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;package-spec xmlns="urn:wildfly:pm-package:1.0" name="p1"&gt;
   &lt;dependencies&gt;
       &lt;package name="p2" /&gt;
       &lt;feature-pack dependency=”fp2-dep”&gt;
           &lt;package name=”p1” /&gt;
           &lt;package name=”p10” /&gt;
       &lt;/feature-pack&gt;
       &lt;package name="p3" /&gt;
   &lt;/dependencies&gt;
&lt;/package-spec&gt;</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_provisioned_package_set">4. Provisioned package set</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter is dedicated to the effective (resolved) package set of the installation&#8217;s provisioning specification.</p>
</div>
<div class="sect2">
<h3 id="_feature_pack_without_dependencies">4.1. Feature-pack without dependencies</h3>
<div class="paragraph">
<p>This chapter focuses on a single feature-pack without dependencies. Effective package set of feature packs with dependencies will be covered in a separate chapter.</p>
</div>
<div class="sect3">
<h4 id="_feature_pack_default_packages">4.1.1. Feature-pack default packages</h4>
<div class="paragraph">
<p>Feature pack may define a set of default packages. This set of default packages is installed implicitly when the feature-pack is installed unless the user provides explicit instructions which packages to install.</p>
</div>
<div class="paragraph">
<p>Default packages are explicitly listed in the <strong>feature-pack.xml</strong> file which is a part of the feature-pack archive. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
               groupId="org.jboss.fp.group1" artifactId="fp1" version="1.0.0" &gt;
   &lt;default-packages&gt;
       &lt;package name="package1" /&gt;
       &lt;package name="package2" /&gt;
   &lt;/default-packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In case this feature-pack is installed without further customizations, <strong>package1</strong> and <strong>package2</strong> will be installed by default, although the feature-pack above may still contain other packages (not listed as default) that may not get installed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_feature_pack_non_default_packages">4.1.2. Feature-pack non-default packages</h4>
<div class="paragraph">
<p>Feature-pack may contain packages that are not marked as default in the <strong>feature-pack.xml</strong>. Non-default packages can be installed either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>implicitly, in case a default package expressed a dependency on a non-default package;</p>
</li>
<li>
<p>explicitly, in case a user explicitly selected a non-default package to be installed.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_feature_pack_original_effective_package_set">4.1.3. Feature-pack original effective package set</h4>
<div class="paragraph">
<p><em>Original</em> in the title means not explicitly modified. I.e. a package set which is going to be installed when a feature-pack is installed as-is without any user customization.</p>
</div>
<div class="paragraph">
<p>The feature-pack original effective package set consists of all the default packages of the feature-pack plus all the packages from the package dependency trees starting from the default packages.</p>
</div>
</div>
<div class="sect3">
<h4 id="_explicit_package_exclusion">4.1.4. Explicit package exclusion</h4>
<div class="paragraph">
<p>A package may be explicitly excluded from the feature-pack effective package set. For example, given the following feature-pack definition:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
               groupId="org.jboss.fp.group1" artifactId="fp1" version="1.0.0" &gt;
   &lt;default-packages&gt;
       &lt;package name="p1" /&gt;
       &lt;package name="p2" /&gt;
   &lt;/default-packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Let’s also assume:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>package <strong>p1</strong> has an optional dependency on non-default package <strong>p11</strong></p>
</li>
<li>
<p>package <strong>p2</strong> has an optional dependency on non-default package <strong>p22</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The original effective package set of <strong>fp1</strong> includes <strong>p1</strong>, <strong>p11</strong>, <strong>p2</strong> and <strong>p22</strong>.</p>
</div>
<div class="paragraph">
<p>If a user is interested in a subset of the effective package set, in fact, only in package <strong>p1</strong>, for example, it can be expressed in the provisioning XML configuration file as</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack groupId="org.jboss.group1" artifactId="fp1" version="1.0.0"&gt;
   &lt;packages&gt;
       &lt;exclude name="p11"/&gt;
       &lt;exclude name="p2"/&gt;
   &lt;/packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Packages <strong>p11</strong> and <strong>p2</strong> are explicitly excluded and package <strong>p21</strong> is a non-default package which is not on the dependency path from the packages to be installed, i.e. <strong>p1</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_explicit_package_inclusion">4.1.5. Explicit package inclusion</h4>
<div class="paragraph">
<p>A package may be explicitly included into the feature-pack effective package set. For example, given the following feature-pack definition:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
               groupId="org.jboss.fp.group1" artifactId="fp1" version="1.0.0" &gt;
   &lt;default-packages&gt;
       &lt;package name="p1" /&gt;
       &lt;package name="p2" /&gt;
   &lt;/default-packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Let’s also assume:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>p2</strong> has an optional dependency on non-default package <strong>p21</strong></p>
</li>
<li>
<p><strong>fp1</strong> also contains non-default package <strong>p3</strong></p>
</li>
<li>
<p><strong>p3</strong> has an optional dependency on non-default package <strong>p31</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The effective package set of <strong>fp1</strong> includes <strong>p1</strong>, <strong>p2</strong> and <strong>p21</strong>.</p>
</div>
<div class="paragraph">
<p>A user may explicitly add package <strong>p3</strong>, exclude <strong>p2</strong> and still leave <strong>p21</strong> in the effective package set using the following configuration:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack groupId="org.jboss.group1" artifactId="fp1" version="1.0.0"&gt;
   &lt;packages&gt;
       &lt;include name="p3"/&gt;
       &lt;exclude name="p2"/&gt;
       &lt;include name="p21"/&gt;
   &lt;/packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The effective package set now will consist of <strong>p1</strong> (default package), <strong>p21</strong> (explicitly included non-default), <strong>p3</strong> (explicitly included non-default) and <strong>p31</strong> (brought in as a dependency of <strong>p3</strong>).</p>
</div>
<div class="paragraph">
<p>If, for example, the user wanted to further cut down the effective set to <strong>p21</strong> and <strong>p3</strong>, the configuration would change to</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack groupId="org.jboss.group1" artifactId="fp1" version="1.0.0"&gt;
   &lt;packages&gt;
       &lt;exclude name="p1"/&gt;
       &lt;exclude name="p2"/&gt;
       &lt;include name="p21"/&gt;
       &lt;include name="p3"/&gt;
       &lt;exclude name="p31"/&gt;
   &lt;/packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_feature_pack_with_dependencies">4.2. Feature-pack with dependencies</h3>
<div class="paragraph">
<p>Feature pack may depend on one or more other feature-packs. Feature-pack dependencies are expressed in the feature-pack&#8217;s metadata, i.e. <strong>feature-pack.xml</strong> file. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
               groupId="org.jboss.fp.group1" artifactId="fp1" version="1.0.0" &gt;
   &lt;dependencies&gt;
       &lt;dependency groupId="org.jboss.dep.group1" artifactId="fp2" version="0.0.1"/&gt;
       &lt;dependency groupId="org.jboss.dep.group2" artifactId="fp3" version="0.0.2"/&gt;
   &lt;/dependencies&gt;
   &lt;default-packages&gt;
       &lt;package name="package1"/&gt;
       &lt;package name="package2"/&gt;
   &lt;/default-packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In this case feature-pack <strong>fp1</strong> depends on feature-packs <strong>fp2</strong> and <strong>fp3</strong>. Let&#8217;s also assume that <strong>fp3</strong> depends on feature-pack <strong>fp4</strong> and <strong>fp2</strong> and <strong>fp4</strong> don’t have any further dependencies. The effective package set of feature-pack <strong>fp1</strong> will consist of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the original effective package set of <strong>fp1</strong>;</p>
</li>
<li>
<p>the original effective package set of <strong>fp2</strong>;</p>
</li>
<li>
<p>the original effective package set of <strong>fp3</strong>;</p>
</li>
<li>
<p>the original effective package set of <strong>fp4</strong>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_customizing_the_inherited_package_set_from_a_dependency">4.2.1. Customizing the inherited package set from a dependency</h4>
<div class="paragraph">
<p>As shown in the example above, the effective package set of the dependency contributes to the effective package set of the feature-pack declaring the dependency. The feature-pack declaring the dependency, though, is allowed to customize the package set inherited from the dependency using the already seen before <strong>include</strong> and <strong>exclude</strong> XML elements in its <strong>feature-pack.xml</strong>. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
               groupId="org.jboss.fp.group1" artifactId="fp1" version="1.0.0" &gt;
   &lt;dependencies&gt;
       &lt;dependency groupId="org.jboss.fp.group2" artifactId="fp2" version="2.0.0"&gt;
           &lt;packages&gt;
               &lt;exclude name="p1"/&gt;
               &lt;exclude name="p2"/&gt;
               &lt;include name="p3"/&gt;
               &lt;include name="p4"/&gt;
           &lt;/packages&gt;
       &lt;/dependency&gt;
   &lt;/dependencies&gt;
   &lt;default-packages&gt;
       &lt;package name="p1"/&gt;
       &lt;package name="p2"/&gt;
   &lt;/default-packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Package inclusion and exclusion under dependency element in <strong>feature-pack.xml</strong> file follows the same principle (in addition to the syntax) as it was described for the provisioning XML configuration file.</p>
</div>
<div class="paragraph">
<p>Now the original effective package set of <strong>fp1</strong> becomes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>fp1</strong> packages <strong>p1</strong> and <strong>p2</strong>;</p>
<div class="ulist">
<ul>
<li>
<p>plus their dependencies on non-default packages (if any);</p>
</li>
</ul>
</div>
</li>
<li>
<p>the original effective package set of <strong>fp2</strong>;</p>
<div class="ulist">
<ul>
<li>
<p>minus packages <strong>p1</strong> and <strong>p2</strong> from <strong>fp2</strong> and their dependencies on other packages;</p>
</li>
<li>
<p>plus packages <strong>p3</strong> and <strong>p4</strong> from <strong>fp2</strong> and their dependencies on other packages.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>Note</strong>: in case <strong>fp2</strong> in its turn depended on other feature-packs then <strong>fp1</strong> would inherit effective package sets of those feature-packs (possibly customized using include/exclude in the corresponding dependency declaration in the <strong>feature-pack.xml</strong> of <strong>fp2</strong>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_disabling_inheritance_of_a_dependency_package_set">4.2.2. Disabling inheritance of a dependency package set</h4>
<div class="paragraph">
<p>By default, the effective package set of a dependency is inherited by the feature-pack declaring the dependency. However, it is possible to declare the dependency without inheriting its effective package set and simply pick the packages manually under the dependency element (in other words to manually define the effective package set of the dependency).</p>
</div>
<div class="paragraph">
<p>Optional boolean attribute <strong>inherit</strong> on the <strong>packages</strong> element controls whether the inheritance is enabled or disabled. In case the attribute is not explicitly specified, its value assumed to be true. Here is an example of a dependency with the inheritance disabled:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
               groupId="org.jboss.fp.group1" artifactId="fp1" version="1.0.0" &gt;
   &lt;dependencies&gt;
       &lt;dependency groupId="org.jboss.fp.group2" artifactId="fp2" version="2.0.0"&gt;
           &lt;packages inherit=”false”&gt;
               &lt;exclude name="p1"/&gt;
               &lt;exclude name="p2"/&gt;
               &lt;include name="p3"/&gt;
               &lt;include name="p4"/&gt;
           &lt;/packages&gt;
       &lt;/dependency&gt;
   &lt;/dependencies&gt;
   &lt;default-packages&gt;
       &lt;package name="p1"/&gt;
       &lt;package name="p2"/&gt;
   &lt;/default-packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Now the original effective package set of <strong>fp1</strong> becomes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>fp1</strong> packages <strong>p1</strong> and <strong>p2</strong>;</p>
<div class="ulist">
<ul>
<li>
<p>plus their dependencies on non-default packages (if any);</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>fp2</strong> packages <strong>p3</strong> and <strong>p4</strong>;</p>
<div class="ulist">
<ul>
<li>
<p>plus their dependencies on non-default packages minus packages <strong>p1</strong> and <strong>p2</strong> from <strong>fp2</strong> and their dependencies on other packages.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_explicit_vs_transitive_dependency_on_a_feature_pack">4.2.3. Explicit vs transitive dependency on a feature-pack</h4>
<div class="paragraph">
<p>Consider a case when feature-pack <strong>fp1</strong> depends on feature-packs <strong>fp2</strong> and <strong>fp3</strong>. And <strong>fp2</strong> in its turn also depends on <strong>fp3</strong>. In this case <strong>fp3</strong> is both transitive and explicit dependency of <strong>fp1</strong>.</p>
</div>
<div class="paragraph">
<p>The rule is that the package set of an explicit dependency overrides the package sets of a transitive dependency. In our case it means that installing <strong>fp1</strong>, the <strong>fp3</strong> package set <strong>fp1</strong> explicitly depends on will become the effective package set of <strong>fp3</strong> ignoring the package set of <strong>fp3</strong> inherited by <strong>fp2</strong> (whether it is a dependency on the original <strong>fp3</strong> or a custom set of its packages).</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
               groupId="org.jboss.fp.group1" artifactId="fp1" version="1.0.0" &gt;
   &lt;dependencies&gt;
       &lt;dependency groupId="org.jboss.fp.group2" artifactId="fp2" version="2.0.0"/&gt;
       &lt;dependency groupId="org.jboss.fp.group2" artifactId="fp3" version="2.0.0"/&gt;
   &lt;/dependencies&gt;
   &lt;default-packages&gt;
       &lt;package name="p1"/&gt;
   &lt;/default-packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
               groupId="org.jboss.fp.group1" artifactId="fp2" version="1.0.0" &gt;
   &lt;dependencies&gt;
       &lt;dependency groupId="org.jboss.fp.group2" artifactId="fp3" version="2.0.0"&gt;
           &lt;packages&gt;
               &lt;exclude name="p1"/&gt;
               &lt;exclude name="p3"/&gt;
           &lt;/packages&gt;
       &lt;/dependency&gt;
   &lt;/dependencies&gt;
   &lt;default-packages&gt;
       &lt;package name="p1"/&gt;
   &lt;/default-packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
               groupId="org.jboss.fp.group1" artifactId="fp3" version="1.0.0" &gt;
   &lt;default-packages&gt;
       &lt;package name="p1"/&gt;
       &lt;package name="p2"/&gt;
       &lt;package name="p3"/&gt;
   &lt;/default-packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Installing <strong>fp1</strong> without further customizations the following packages will be installed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>fp1:p1</strong> and its dependencies;</p>
</li>
<li>
<p><strong>fp2:p1</strong> and its dependencies;</p>
</li>
<li>
<p><strong>p1</strong>, <strong>p2</strong> and <strong>p3</strong> from <strong>fp3</strong> and their dependencies.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_merging_package_sets_from_dependency_branches">4.2.4. Merging package sets from dependency branches</h4>
<div class="paragraph">
<p>Suppose feature-pack <strong>fp1</strong> depends on feature-packs <strong>fp2</strong> and <strong>fp3</strong>. Both <strong>fp2</strong> and <strong>fp3</strong> depend on their own custom package sets of feature-pack <strong>fp4</strong>. When <strong>fp1</strong> is installed, the effective package set of <strong>fp4</strong> will be a merge of custom package sets of <strong>fp4</strong> specified as dependencies of <strong>fp2</strong> and <strong>fp3</strong>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
               groupId="org.jboss.fp.group1" artifactId="fp1" version="1.0.0" &gt;
   &lt;dependencies&gt;
       &lt;dependency groupId="org.jboss.fp.group2" artifactId="fp2" version="2.0.0"/&gt;
       &lt;dependency groupId="org.jboss.fp.group2" artifactId="fp3" version="2.0.0"/&gt;
   &lt;/dependencies&gt;
   &lt;default-packages&gt;
       &lt;package name="p1"/&gt;
   &lt;/default-packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
               groupId="org.jboss.fp.group1" artifactId="fp2" version="1.0.0" &gt;
   &lt;dependencies&gt;
       &lt;dependency groupId="org.jboss.fp.group2" artifactId="fp4" version="2.0.0"&gt;
           &lt;packages&gt;
               &lt;exclude name="p1"/&gt;
               &lt;exclude name="p3"/&gt;
           &lt;/packages&gt;
       &lt;/dependency&gt;
   &lt;/dependencies&gt;
   &lt;default-packages&gt;
       &lt;package name="p1"/&gt;
   &lt;/default-packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
               groupId="org.jboss.fp.group1" artifactId="fp3" version="1.0.0" &gt;
   &lt;dependencies&gt;
       &lt;dependency groupId="org.jboss.fp.group2" artifactId="fp4" version="2.0.0"&gt;
           &lt;packages inherit=”false”&gt;
               &lt;!-- assume fp4 also contains non-default package p4 --&gt;
               &lt;include name="p4"/&gt;
           &lt;/packages&gt;
       &lt;/dependency&gt;
   &lt;/dependencies&gt;
   &lt;default-packages&gt;
       &lt;package name="p1"/&gt;
   &lt;/default-packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack xmlns="urn:wildfly:pm-feature-pack:1.0"
               groupId="org.jboss.fp.group1" artifactId="fp4" version="1.0.0" &gt;
   &lt;default-packages&gt;
       &lt;package name="p1"/&gt;
       &lt;package name="p2"/&gt;
       &lt;package name="p3"/&gt;
   &lt;/default-packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>If a user installs <strong>fp1</strong> without further customizations, the following packages will be installed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>fp1:p1</strong> and its dependencies;</p>
</li>
<li>
<p><strong>fp2:p1</strong> and its dependencies;</p>
</li>
<li>
<p><strong>fp3:p1</strong> and its dependencies;</p>
</li>
<li>
<p><strong>fp4:p2</strong>, <strong>fp4:p4</strong> and their dependencies.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wildfly_provisioning">5. WildFly provisioning</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_wildfly_pm_provisioning_plug_in">5.1. WildFly PM Provisioning Plug-in</h3>
<div class="paragraph">
<p>This chapter describes the WildFly provisioning plug-in which is included into feature-packs of WildFly-based distributions.</p>
</div>
<div class="paragraph">
<p>The plug-in is called by the PM tool after the feature-pack and package dependencies have been resolved and the content from packages has been copied to the target installation directory.</p>
</div>
<div class="paragraph">
<p>The WildFly provisioning plug-in is then responsible for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#config-gen">generating the configuration file(s) based on the installed package set (possibly customized by the user)</a>;</p>
</li>
<li>
<p><a href="#module-jars">building "thin" servers (i.e. servers with module.xml files referencing module JARs as Maven artifacts) or copying module JARs into the target installation</a>;</p>
</li>
<li>
<p><a href="#wildfly-tasks-xml">performing other tasks configured in wildlfy-tasks.xml</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="config-gen">5.1.1. Configuration generation</h4>
<div class="paragraph">
<p>The configuration of the target installation is generated by executing WildFly CLI scripts collected from the packages making up the installation.</p>
</div>
<div class="paragraph">
<p>Based on the feature-pack and package dependencies, the PM tool determines the order in which the packages making up the installation should be installed. The WildFly provisioning plug-in then iterates through the packages in that order collecting CLI scripts that represent package-specific configuration snippets.</p>
</div>
<div class="paragraph">
<p>Once all the CLI scripts have been collected, the plug-in launches a CLI session, embeds the server with an empty configuration and runs the collected scripts.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note: <strong>the scripts are not executed in a batch</strong> (i.e. as a composite operation). In case some operations have to be combined into a batch, it is the responsibility of the package developer to start and run the batch from the script attached to the package.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In case any of the CLI command and/or operation fails, the whole provisioning process will be aborted by the PM tool.</p>
</div>
</div>
<div class="sect3">
<h4 id="module-jars">5.1.2. Thin servers vs local module JARs</h4>
<div class="paragraph">
<p>By default, the plug-in will resolve Maven module artifacts and copy the JARs to the target installation.</p>
</div>
<div class="paragraph">
<p>However, the plug-in checks system property <strong>wfThinServer</strong> and if it is present and its value is empty or true, the resulting installation will not include the module JARs but will reference the corresponding Maven artifacts instead from the modules' <strong>module.xml</strong> files.</p>
</div>
<div class="paragraph">
<p>The system property has to be set either on the command line launching the PM tool, e.g.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">pm -DwfThinServer &lt;other arguments&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>or from a Java client using the PM public API.</p>
</div>
</div>
<div class="sect3">
<h4 id="wildfly-tasks-xml">5.1.3. wildfly-tasks.xml</h4>
<div class="paragraph">
<p>WildFly feature-packs may include <strong>wildfly-tasks.xml</strong> file into their <strong>resources/wildfly</strong> directory. The currently supported tasks include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>set filesystem permissions on the specified paths;</p>
</li>
<li>
<p>create empty directories;</p>
</li>
<li>
<p>correct line endings for the target operating system for the specified files.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an example of <strong>wildfly-tasks.xml</strong>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;tasks xmlns="urn:wildfly:wildfly-feature-pack-tasks:2.0"&gt;
   &lt;mkdirs&gt;
       &lt;dir name="domain/data/content"/&gt;
       &lt;dir name="standalone/lib/ext"/&gt;
       &lt;dir name="domain/tmp/auth"/&gt;
       &lt;dir name="standalone/tmp/auth"/&gt;
       &lt;dir name=".installation"/&gt;
   &lt;/mkdirs&gt;
   &lt;file-permissions&gt;
       &lt;permission value="755"&gt;
           &lt;filter pattern="*.sh" include="true"/&gt;
           &lt;filter pattern="*" include="false"/&gt;
       &lt;/permission&gt;
       &lt;permission value="700"&gt;
           &lt;filter pattern="*/tmp/auth" include="true"/&gt;
           &lt;filter pattern="*" include="false"/&gt;
       &lt;/permission&gt;
       &lt;permission value="600"&gt;
           &lt;filter pattern="*-users.properties" include="true"/&gt;
           &lt;filter pattern="*/.installation" include="true"/&gt;
           &lt;filter pattern="*" include="false"/&gt;
       &lt;/permission&gt;
   &lt;/file-permissions&gt;
&lt;/tasks&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wildfly_feature_pack_building_maven_plug_in">5.2. WildFly Feature-pack Building Maven Plug-in</h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="_demo">5.3. Demo</h3>
<div class="paragraph">
<p>This chapter describes how to try the tool provisioning WildFly Core, Servlet and Full distributions and their customized versions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please, just keep in mind, there hasn&#8217;t been even an Alpha release, it&#8217;s not perfect. This chapter is here for people interested in following the evolution of the tool and communicating their requirements. Please direct your questions or feedback to <a href="mailto:olubyans@redhat.com">the developer</a>. Thanks!
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_the_tool">5.3.1. The tool</h4>
<div class="paragraph">
<p>The tool can be downloaded from <a href="https://github.com/aloubyansky/pm/tree/demo">here</a> and then built using</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">mvn clean install</pre>
</div>
</div>
<div class="paragraph">
<p>There is also <code>./do.sh</code> script for convenience in the root directory of the project which, if launched w/o arguments, will build the project and launch the tool&#8217;s command-line interface.
The command-line interface can also be launched w/o re-building the project by</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">./do.sh run</pre>
</div>
</div>
<div class="paragraph">
<p>The CLI session can be terminated by executing command <code>exit</code> or simply pressing <code>Ctrl-C</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_wildfly_core">5.3.2. WildFly Core</h4>
<div class="paragraph">
<p>The branch of WildFly Core that uses the Maven plug-in from the provisioning tool to build the new feature-packs (along with the currently actually in-use ones) and install them into the local Maven repo is <a href="https://github.com/aloubyansky/wildfly-core/tree/new-feature-pack-demo">here</a>.</p>
</div>
<div class="paragraph">
<p>Check it out and build WildFly Core using</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">mvn clean install -DskipTests</pre>
</div>
</div>
<div class="paragraph">
<p>to install the new provisioning feature-packs into your local Maven repository.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
skipping the tests is suggested only to save your time, there aren&#8217;t any expected failures.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_wildfly_servlet_and_full">5.3.3. WildFly Servlet and Full</h4>
<div class="paragraph">
<p>Servlet and Full feature-packs are produced by the same build process in <a href="https://github.com/aloubyansky/wildfly/tree/new-feature-pack-demo">this branch</a>.</p>
</div>
<div class="paragraph">
<p>Check it out and build the project using</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">mvn clean install -DskipTests</pre>
</div>
</div>
<div class="paragraph">
<p>to install WildFly Servlet and Full feature-packs into your local Maven repository.</p>
</div>
</div>
<div class="sect3">
<h4 id="_installing_core_servlet_and_full_distributions">5.3.4. Installing Core, Servlet and Full distributions</h4>
<div class="paragraph">
<p>Once you&#8217;ve downloaded and built the tool and then the <code>wfcore</code> and <code>wildfly</code> projects, have the feature-packs installed into your local repositories, you can try using the tool to actually install the projects at a specific location.</p>
</div>
<div class="paragraph">
<p>Here is how you can install the core:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">./do.sh run
[pm]$ install org.wildfly.core:wildfly-core-feature-pack-new:3.0.0.Beta29-SNAPSHOT --dir=&lt;installation-home&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Tab-completion should work for the feature-pack coords.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Prompt <code>[pm]$</code> indicates that the current file-system directory is <code>pm</code>.</p>
</div>
<div class="paragraph">
<p><code>--dir</code> argument is optional, if it is not present, the current file-system directory will be used as the installation home directory.</p>
</div>
<div class="paragraph">
<p>Servlet and Full distributions can be installed with the same command but using the corresponding feature-pack coordinates, i.e.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.wildfly:wildfly-servlet-feature-pack-new:11.0.0.Beta1-SNAPSHOT</code> for the Servlet distribution;</p>
</li>
<li>
<p><code>org.wildfly:wildfly-feature-pack-new:11.0.0.Beta1-SNAPSHOT</code> for the Full distribution.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since Full feature-pack depends on Servlet feature-pack and Servlet feature-pack depends on Core feature-pack, installing Full feature-pack will implicitly install Servlet and Core feature-packs.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_uninstalling_a_feature_pack">5.3.5. Uninstalling a feature-pack</h4>
<div class="paragraph">
<p>Using the Core as an example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">[pm]$ uninstall org.wildfly.core:wildfly-core-feature-pack-new:3.0.0.Beta29-SNAPSHOT --dir=&lt;installation-home&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_exporting_current_provisioning_specification">5.3.6. Exporting Current Provisioning Specification</h4>
<div class="literalblock">
<div class="content">
<pre class="nowrap">[pm]$ cd &lt;installation-home&gt;
[&lt;installation-home&gt;]$ provisioned-spec export &lt;work-dir&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><code>&lt;work-dir&gt;</code> will contain <code>provisioning.xml</code> which is the current provisioning specification of the installation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_provisioning_specific_default_configuration">5.3.7. Provisioning specific default configuration</h4>
<div class="paragraph">
<p>Installing any of the feature-packs will produce an installation that is equivalent to our default build or release, meaning it will contain all the modules, standalone and domain configurations.</p>
</div>
<div class="paragraph">
<p>Each feature-pack has a package called <code>dist.standalone</code>. If this package is selected, it will pull the modules and configuration necessary to run the standalone server. Here is how a user can install only the standalone server:</p>
</div>
<div class="paragraph">
<p>1) Export the <code>provisioning.xml</code> from the default installation to use as a config template.</p>
</div>
<div class="paragraph">
<p>2) Modfiy the feature-pack config (let&#8217;s use Core as an example) to</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;feature-pack groupId="org.wildfly.core" artifactId="wildfly-core-feature-pack-new" version="3.0.0.Beta29-SNAPSHOT"&gt;
    &lt;packages inherit="false"&gt;
        &lt;include name="dist.standalone"/&gt;
    &lt;/packages&gt;
&lt;/feature-pack&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>3) From the provisioning CLI execute</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">provision-spec &lt;work-dir&gt;/provisioning.xml --dir=&lt;installation-home&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>What you&#8217;ve done is excluded all the packages installed by default from the specified feature-pack and included only <code>dist.standalone</code> and its dependencies that are installed implicitly.
You can do the same exercise for <code>dist.domain</code> package.</p>
</div>
<div class="paragraph">
<p>Complete list of the default (pre-defined) distributions that can be installed in this way for Core feature-pack is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dist.standalone</p>
</li>
<li>
<p>dist.domain</p>
</li>
<li>
<p>dist.legacy (combines the packages above)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>for Servlet feature-pack:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dist.standalone</p>
</li>
<li>
<p>dist.load-balancer</p>
</li>
<li>
<p>dist.domain</p>
</li>
<li>
<p>dist.legacy (combines the packages above)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>for Full feature-pack:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dist.domain</p>
</li>
<li>
<p>dist.domain-full</p>
</li>
<li>
<p>dist.domain-full-ha</p>
</li>
<li>
<p>dist.domain-ha</p>
</li>
<li>
<p>dist.domain-load-balancer</p>
</li>
<li>
<p>dist.standalone</p>
</li>
<li>
<p>dist.standalone-full</p>
</li>
<li>
<p>dist.standalone-full-ha</p>
</li>
<li>
<p>dist.standalone-ha</p>
</li>
<li>
<p>dist.legacy (combines the packages above)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can try customizing the installation further by including and/or excluding specific packages that represent modules and subsystems in the same way.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0.0.Alpha-SNAPSHOT<br>
Last updated 2017-04-09 13:17:40 CEST
</div>
</div>
</body>
</html>